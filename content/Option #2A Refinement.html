<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TAXA Project - ConversationalRetrievalChain + VectorStoreRetrieverMemory</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../millerlogo.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      TAXA Project
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/millerlogo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">TAXA Project</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://library.stanford.edu/hopkins" rel="" title="Hopkins Marine Station" class="quarto-navigation-tool px-1" aria-label="Hopkins Marine Station"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/Miller-Library" rel="" title="Harold A. Miller Library" class="quarto-navigation-tool px-1" aria-label="Harold A. Miller Library"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/plan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Plan</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experiments</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#conversationalretrievalchain-with-map_reduce" id="toc-conversationalretrievalchain-with-map_reduce" class="nav-link active" data-scroll-target="#conversationalretrievalchain-with-map_reduce">ConversationalRetrievalChain with map_reduce</a></li>
  <li><a href="#conversationalretrievalchain-similarity-search-w-conversationbuffermemory" id="toc-conversationalretrievalchain-similarity-search-w-conversationbuffermemory" class="nav-link" data-scroll-target="#conversationalretrievalchain-similarity-search-w-conversationbuffermemory"><strong><em>ConversationalRetrievalChain Similarity Search w/ ConversationBufferMemory </em></strong></a>
  <ul class="collapse">
  <li><a href="#concept-used-for-streamlit-app" id="toc-concept-used-for-streamlit-app" class="nav-link" data-scroll-target="#concept-used-for-streamlit-app">Concept used for Streamlit App</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/Miller-Library/taxa_webV2/blob/main/content/Option #2A Refinement.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Miller-Library/taxa_webV2/blob/main/content/Option #2A Refinement.ipynb" class="toc-action">View source</a></p><p><a href="https://github.com/Miller-Library/taxa_webV2/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ConversationalRetrievalChain + VectorStoreRetrieverMemory</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import dependencies</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openai</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys, pathlib, fitz</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PyPDF2 <span class="im">import</span> PdfReader, PdfWriter</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.chains <span class="im">import</span> ConversationalRetrievalChain</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.document_loaders <span class="im">import</span> PyMuPDFLoader</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.text_splitter <span class="im">import</span> TokenTextSplitter</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.embeddings.openai  <span class="im">import</span> OpenAIEmbeddings</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.vectorstores <span class="im">import</span> FAISS</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.retrievers <span class="im">import</span> ContextualCompressionRetriever</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.retrievers.document_compressors <span class="im">import</span> LLMChainExtractor</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.retrievers.document_compressors <span class="im">import</span> LLMChainFilter</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.chat_models <span class="im">import</span> ChatOpenAI</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.memory <span class="im">import</span> ConversationBufferMemory</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain <span class="im">import</span> PromptTemplate</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.chains.conversational_retrieval.prompts <span class="im">import</span> CONDENSE_QUESTION_PROMPT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv, find_dotenv</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> load_dotenv(find_dotenv()) <span class="co"># read local .env file</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>openai.api_key  <span class="op">=</span> os.environ[<span class="st">'OPENAI_API_KEY'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PyPDF2 <span class="im">import</span> PdfReader, PdfWriter</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">''' Function for identifying and removing the first page with defined variations of 'bibiliography',</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">and all subsequent pages, from the original file while creating a new file with the remaining pages.'''</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_citation_pages(pdf_path):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    pdf_reader <span class="op">=</span> PdfReader(pdf_path)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    new_pdf <span class="op">=</span> PdfWriter()</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Define list of variations of citation to look for in the input file</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    citation_variations <span class="op">=</span> [<span class="st">"Bibliography"</span>,<span class="st">"Works Cited"</span>, <span class="st">"References"</span>, <span class="st">"Citations"</span>, <span class="st">"Literature Cited"</span>, <span class="st">"Literature Citations"</span>]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    citation_found <span class="op">=</span> <span class="va">False</span> <span class="co">#Flag to track if a citation variation is found</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Iterates through each page in the input file, returns the index "page_num" and the actual page object</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page_num, page <span class="kw">in</span> <span class="bu">enumerate</span>(pdf_reader.pages):</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        page_text <span class="op">=</span> page.extract_text() <span class="co">#Extracts text from the current page</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Check if a citation variation is found in the page_text or its uppercase version</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> citation_found:</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> variation <span class="kw">in</span> citation_variations: <span class="co">#iterations through each variation of citations list</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> variation <span class="kw">in</span> page_text <span class="kw">or</span> variation.upper() <span class="kw">in</span> page_text:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                    citation_found <span class="op">=</span> <span class="va">True</span> <span class="co">#loop breaks when any variation is found (True)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> citation_found: <span class="co">#after checking through all citations_variations, page will be added to new file</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            new_pdf.add_page(page)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    new_pdf_path <span class="op">=</span> <span class="st">"output.pdf"</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(new_pdf_path, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        new_pdf.write(f)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_pdf_path</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_new_pdf(new_pdf_path):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    pdf_reader <span class="op">=</span> PdfReader(new_pdf_path)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    pdf_text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page <span class="kw">in</span> pdf_reader.pages:</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        pdf_text <span class="op">+=</span> page.extract_text()</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pdf_text</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_line_breaks(text):</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Join lines that have been incorrectly split</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    fixed_text <span class="op">=</span> text.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># More line break fixing tasks can be added here</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fixed_text</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the remove_citation_pages function to generate the new PDF</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>input_pdf_path <span class="op">=</span> <span class="st">'./fhl_2014_Charifson_34622 (1).pdf'</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>output_pdf_path <span class="op">=</span> remove_citation_pages(input_pdf_path)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and print the content of the new PDF</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>new_pdf_content <span class="op">=</span> read_new_pdf(output_pdf_path)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>new_df <span class="op">=</span> fix_line_breaks(new_pdf_content)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(new_df) <span class="co">#String object</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Charifson 1   Snail Predation by  Hemigrapsus nudus  and Hemigrapsus oregonensis : Sex and Species  Differences in Chela Size.     David Charifson1,2    Marine Invertebrate Zoology   Summer 2014           1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250   2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794 -5245           Contact information:   David Charifson   Department of Ecology and Evolution   Stony Brook University   650 Life Sciences Building   Stony Brook, NY 11794 -5245   David.charifson@s tonybrook.edu           Keywords : Hemigrapsus nudus , Hemigrapsus orogenensis , Littorina scutulata , Lacuna vincta ,  predation, sexual dimorphism, character displacement      Charifson 2   Abstract:    The relationship between propus size and use of snails as prey in sympatric popu lations  of Hemigrapsus nudus  and Hemigrapsus oregonensis  was investigated.  Propal height and propal  width increases with body size in a predictable manner in male and female crabs of both species.   Sexual dimorphism of propa l height and width relationships in both shore crabs is apparent, but  there was  no detectible difference in chela  size between H. nudus  and H. oregonensis . The lack  of difference in chela  size between sympatric H. nudus  and H. oregonensis  suggests that there is  no character displacement i n this trait.  Both species of crabs showed a strong feeding preference  for the thin -shelled gastropod  Lacuna vincta  over the thicker shelled Littorina scutulata , likely  due to the ease of consumption.  There were no differences in snail consumption rates be tween  male and fem ale H. nudus  of similar propal heigh ts, mostly due to high feeding variation  among  individual crabs.     Introduction:    A multitude of species coexist in the marine intertidal environment . Closely related  species may be sympatric and  compe te for resources, such as food. Two species of shore crab,  Hemigrapsus nudus  (Dana  1851 ) and Hemigrapsus oregonensis  (Dana  1851 ), occur in sympatry  in the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae.  Species in symp atry may exhibit character displacement, the exaggeration of morphological or  behavioral characteristics due to competition  for resources  (Brown and Wilson 1956 ). When H.  nudus  and H. oregonensis  co-occur , H. oregonensis  tends to be found closer to the wat erand in  finer sediment tha n the more desiccation -tolerant H. nudus  (Sliger 1982). There is still  considerable habitat overla p between the se two  species; the underside of a  single rock may have  Charifson 3   roughly equal abundances  of the two crab species (personal obs ervation). The size of the chela   may differ , which  could allow the crabs to d ifferentiate in food resource utilization .  Both species  are omnivores that eat algae and small invertebrates, including snails   (Behrens Yamada and Boulding 199 6). The two shore cr ab species are known to eat Littorina  sitkana  (Philippi 1846 ) and Littorina scutulata  (Gould  1849 ), which also occur in the rocky  intertidal  zone  (Behrens Yamada and Boulding 1996). Li. scutulata  moves upshore in response  to the presence of H. nudus  and crushed conspecifics, where H. nudus  density is lower  (Keppel  and Scrosati 2004). This suggests that H. nudus  represents an ecologically significant  predation   threat to littorines .    The thick shelled littorines are difficult prey for both H. nud us and H. oregonensis  as  neither crab species is a molluscivore specialists ; they  typically scrape or pick algae and softer  invertebrates off rocks using their chelae  (Behrens Yamada and Boulding 1996) . Behrens  Yamada and Boulding  (1998)  found  that large H. nudus  were capable of consuming Li. sitkana   that were less than 8 mm in length, but had only a 37% success rate of consuming snails with  lengths between 5.5 -7 mm .   I sought to investigate differences in  propus  size between  between males and females of  these  two crab species . The size of the propus of the chela  is positively correlated with the  amount of force that can be produced  due to greater musculature ( Behrens Yamada and Boulding  1998 ). A significant difference in propus size between the two species would suggest that further  testing of character displacement may be warranted. A disparity in propus size to body size  between male and female crabs might result in different feeding rates and shell breaking  capabilities. I devised a test of preference by varyin g snail shell strength within the same size  class. The snail species Li. scutulata  and Lacuna vincta  (Montagu  1803 ) are both in the family Charifson 4   Littorinidae and have similar shell shape but different shell thickness. Lacuna vincta  has a  thinner, more fragile sh ell and is likely to be preferred as prey  by shore crabs. I  also hypothesize  that, if chela  size is held constant , female crabs will have greater snail consumption rates than  male crabs. Female crabs with claws equivalent to males  have a larger body mass ,are likely to   have greater metabolic need , and are less easily satiated.     Study System:    All specimens were collected on San Juan Island, Washington.  Two shore crabs (clade:  Brachyura: Family Grapsidae), Hemigrapsus oregonensis   and Hemigrapsus nudus  were   collected in the intertidal adjacent to the Friday Harbor Lab oratories  dock.  These closely related  crabs are morphologically similar, but can be distinguished by the presence of purple spots on  the cheliped of H. nudus  and abundant setae on the pereopods of H. oregonensis  (Kozloff 1987) .  Lacuna vincta , in the Class Gastropoda and Family Littoridae, were collected at False Bay and  Dead Man  Cove . Littorina scutulata , in the Class Gastropoda and Family Littoridae, were  collected from the rocky intertidal zone  of Fourth of July Beach.     Materials and Methods:   Morphometrics    Male and females of H. oregonensis  and H. nudus  were measured with digital calipers   (0.1 mm) . Each crab was measured for carapace width, propal height and propal width. Carapace  width was ta ken at the widest part of the carapace. Propal height was measured at the highest  vertical distance along the propus. Propal width was measured perpendicular  to propal height ,  from the left to right sides of the propus. All claw measurements were made on the left cheliped. Charifson 5   If there was a size disparity  between the left and right claws due to regeneration of a lost claw ,  the crab was excluded from the study. Ratios of carapace width :propal height (CW:PH) and  carapace width :propal width (CW:PW)  were calculate d.     Crab Feeding Preference    Three female (Fe1, Fe2, Fe3) and three male (Ma1, Ma2, Ma3)  crabs of H. nudus  with  propal heights between 5 -6 mm  were placed in small flow -through containers. Five L. scutulata   and five L. vincta  with shell lengths between 4 -6 mm were added to each container. The ranges  of crab propal height and snail shell length were chosen based on prior studies to ensure that the  crabs were capable of feeding on the hard -shelled L. scutulata  (Behrens Yamada and Boulding  1998). H. oregonensi s was excluded due to the rarity of female crabs of that species within the  range of appropriate propal heights. After approximately 15 hours the number of L. scutulata  and  L. vincta  consumed was counted . Three trials were conducted for each crab .  Snail Co nsumption by Hemigrapsus nudus    The crabs from the preference experiment were given five of each snail  in each trial .  After 1.5 to 3 hours the number of snails consumed was counted and convert ed to a consumption  rate (snails consumed/ hour). A total of eig ht feeding trials were conducted.      Statistical Analysis    For the morphometric analysis , crabs were divided into four groups based on sex and  species. Standardized major axis regression was used to determine the relationship between crab  morphometric param eters. Arcsin transformations were used to correct fo r non -normality  (Sokol  and Rohlf 2011) . Differences in CW:PH and CW: PW were analyzed using a two -way ANOVA Charifson 6   with factors: Sex and Species . Prey selection by H. nudus  was analyzed using G -tests for each  individual that consumed snails. An one-way ANOVA was used to determine differences in snail  consumption rates by H. nudus .     Results:   Morphometrics:    Carapace width was a good predictor of both propal height (Figure 1, Table 1A) and  propal width  (Figure 2, Table 1B) in female and male H. oregonensis  and H. nudus . There was  less variation in the relationship between carapace width and propal height than with propal  width.   Due to non -normality of CW:PH and CW:PW an arcsin transformation was used . A  significant effect for sex was found for both CW:PH (F 1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F 1,  45 = 103.81, p &lt; 0.001). There was no significant difference between  Hemigrapsus  species for   CW:PH  (F1, 45 &lt; 0.01, p = 0.983)  and CW:PW (F1, 45 = 0.09, p = 0.764). A significant  sex*species interaction was detected fo r both CW:PH (F 1, 45 4.39, p = 0.042) and CW:PW (F 1, 45  = 7.19, p = 0.010).  Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species  respectively.     Crab Feeding Preference :    Expe cted values for both the number of L. scutulata  and L. vincta  consumed for the G - test are 0.5 multiplied by  the total number of snails  consumed by each individual crab . G-tests  for individual H. nudus  that eat snails were all significant at p &lt; 0.001 with 1 degree of freedom  (See Table 2 for statistical summary). The  three crabs that did not eat either L. scutulata  or L.  vincta  could not be tested for feeding preference.  Charifson 7     Snail Consumption by Hemigrapsus nudus    No significant difference in crab feeding rate  (snails consumed/hour) was found (F 2, 21 =  2.52, p = 0.104)  among individual H. nudus  that fed on snails during the course of the  consumption experiment (Figure 5). Fe2  ate snails at a rate of 0.59±0.53 snails/hour (variance is  standard deviation), Ma1 feeding rate was 0.24± 0.31 snails/hour, and Ma2 had a feeding  rate of  0.80±0.38 snails/hour. Individuals Fe1, Fe3 and Ma3 did not consume any snails during the  course of the experiment.     Discussion:    A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus   and Hemigrapsus orogenensis . The variance in propal height or propal width explained by   carapace width  was surprisingly high  in female H. nudus  with R2 values of 0.976  found for  propal height and 0.927 for propal width . Male H. oregenensis  had the greatest variation in chela  size parame ters, demonstrated by  R2 of 0.693 and 0.534 for propal height and propal width  respectively.  The R2 values for propal width regressed against carapace width were consistently  lower than propal height regressed against carapace width across species and sexes (Table 1). In  general the ability of carapace width t o explain the variance in chela  size parameters (i .e.: R2  values) was greater in females of both crab species (Table 1, Figur es 1 and 2). Males may have  more variation in claw size due to trade -offs between claw size and factor s like feeding  efficiency or resource allocation . Trade -offs relatin g to chela size are found in  fiddler crabs,  which exhibit extr eme sexual dimorphism . Fiddler crabs have  a trade -off between the intrasexual  competition and intersexual signaling functions of the dimorphic claw (Swanson et al. 2013 ). Charifson 8   This is not to say that the particular trade -offs in fiddler crabs case are analogou s to that of  Hemigrapsus , since both claws in the two shore crabs in this study are used in feeding.   Sexual dimorphism in chela  size, which is readily apparent to the eye in both  Hemigrapsus nudus  and Hemigrapsus oregonensis , was detected statistically  (Figures 3 and 4).  The two -way ANOVA with factors sex and species did not show a significant species effect,  suggesting that the claws of both shore crabs produce roughly the same force  and are  functionally equivalent  (Behrens Yamada and Boulding 1998). The lack of morphological  difference in the size of the chelae between the crab species removes the possibility of character  displacement in the trait. It should be noted that this study was not designed to  test for  character  displacement, but to determine if  this would be an interesting question for  future investigations.  To make a compelling case for character displacement it is necessary to compare multiple  sympatric and allopatric populations with similar abiotic and biotic conditions (Stuart and Losos  2013). Also it must be demonstrated that the trait differs due to genetic differences between  sympatric and allopatric populations, that the differences between the populations are not due to  species sorting, that the morphological trait is correlated to diff erences in resource use between  the two sympatric species, and that the similar phenotype in allopatric populations compete for  the same resources (Stuart and Losos 2013). The tendency of H. nudus  to occupy the upper  intertidal zone (Sliger 1987) , despite considerable overlap with H. oregonensis , may provide  enough differential resource use to prevent exclusion in sympatry. Desiccation tolerance may be  a better trait to test for character displacement in these shore crabs.   H. nudus  males and females clearl y preferred to eat the thinner shelled Lacuna vincta   (Table 2). During the course of the feeding preference experiment all the crabs that ate snails  consumed L. vincta  exclusively. However, one Littorina scutuala  was eaten by H. nudus  when  Charifson 9   determining cons umption rates. The six crabs were chosen because their claws were of  approp riate size to eat littorines with shell length between  4-6 mm, yet only half of the crabs ate  these snails. This could be  due to insufficient  time to acclimate H. nudus  to lab condi tions and  possibly reduced feeding associated with molting. Male snow crabs , Chionoecetes opilio , were  shown to cease feeding 3 -6 weeks before and 3 -4 weeks after molting ( O’Halloran and O’Dor  1988).   It was my original intention to test for sex difference s in consumption rates, but this was  not possible as I could not collect many crabs of the appropriate claw size for gastropod feeding  and many of the crabs I did collect did not feed. There were no statistically significant  difference s in consumption rate s (snails eaten/hour) among the three feeding H. nudus . These  individuals had highly variable feeding rates, mostly due to trials  in which the crab did not feed.  Sylvia Behrens Yamada and Elizabeth Boulding (1998) found that H. nudus  consumed 1.8  Littorina . sitkana /individual crab/ day. In my study crabs fed on 13.03 Lacun a vincta /individual  crab/ day. The greater consumption rate in my study is likely due to the easily breakable shells of  La. vincta .   The findings of this study suggest that there is no pote ntial for character displacement of  chela size in the sympatric H. nudus  and H. oregonensis . This leaves the question of species co - occurrence open to other possibilities. H. nudus  has a strong preference for La. vincta , but it  seems as if there have been no studies that show predation on La. vincta  in the field . It should be  noted that H. nudus  and La. vincta  usually occupy different portions of the intertidal and may  have little contact with each other, unlike the relationship between H. nudus  and Li. scutulata .  There is some potential for overlap in the winter when La. vincta migrates up shore . Although no  differences in consumption rates between male and female H. nudus  were found, this might be Charifson 10   due to logistical issues surrounding the experimental design and little replication. Future studies  should include more crabs, the exclusion of  non-feeding crabs, and trial periods with longer time  intervals. Additionally, any subsequent study should utilize multivariate and geometric  morphometric methods to quantify claw shape instead of using ratios, as two similar ratios may  have different shape.     Acknowledgements:    I would like to thank Dianna Padilla, Michael LaBarbera, and K evin Turner for advice   relating to the experimental design of this study. I would also like to thank the d irector and staff  of Friday Harbor Laboratories for use of facilities and  permission to collect organisms . Friday  Harbor Laboratories, The Libbie Hyman Scholarship, Society for Inte grative and Comparative  Biology , and the Stony Brook Department of Ecology a nd Evolution provided financial support   and have my gratitude .                      </code></pre>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_text_from_pdf(pdf_path):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> fitz.<span class="bu">open</span>(pdf_path)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page <span class="kw">in</span> doc:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        text <span class="op">+=</span> page.get_text()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    doc.close()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace 'output.pdf' with the path to the PDF you created with citation pages removed</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>new_pdf_path <span class="op">=</span> <span class="st">'output.pdf'</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract text from the new PDF</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>new_pdf_text <span class="op">=</span> extract_text_from_pdf(new_pdf_path)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can manipulate the extracted text or perform any other actions as needed</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, you can print the extracted text:</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(new_pdf_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Charifson 1 
 
Snail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species 
Differences in Chela Size. 
 
David Charifson1,2 
 
Marine Invertebrate Zoology 
Summer 2014 
 
 
 
 
1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250 
2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794-5245 
 
 
 
 
Contact information: 
David Charifson 
Department of Ecology and Evolution 
Stony Brook University 
650 Life Sciences Building 
Stony Brook, NY 11794-5245 
David.charifson@stonybrook.edu  
 
 
 
 
Keywords: Hemigrapsus nudus, Hemigrapsus orogenensis, Littorina scutulata, Lacuna vincta, 
predation, sexual dimorphism, character displacement  
 
 
Charifson 2 
 
Abstract: 
 
The relationship between propus size and use of snails as prey in sympatric populations 
of Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal 
width increases with body size in a predictable manner in male and female crabs of both species. 
Sexual dimorphism of propal height and width relationships in both shore crabs is apparent, but 
there was no detectible difference in chela size between H. nudus and H. oregonensis. The lack 
of difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is 
no character displacement in this trait. Both species of crabs showed a strong feeding preference 
for the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely 
due to the ease of consumption. There were no differences in snail consumption rates between 
male and female H. nudus of similar propal heights, mostly due to high feeding variation among 
individual crabs.  
 
Introduction: 
 
A multitude of species coexist in the marine intertidal environment. Closely related 
species may be sympatric and compete for resources, such as food. Two species of shore crab, 
Hemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry 
in the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. 
Species in sympatry may exhibit character displacement, the exaggeration of morphological or 
behavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. 
nudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in 
finer sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still 
considerable habitat overlap between these two species; the underside of a single rock may have 
Charifson 3 
 
roughly equal abundances of the two crab species (personal observation). The size of the chela 
may differ, which could allow the crabs to differentiate in food resource utilization. 
Both species are omnivores that eat algae and small invertebrates, including snails 
(Behrens Yamada and Boulding 1996). The two shore crab species are known to eat Littorina 
sitkana (Philippi 1846) and Littorina scutulata (Gould 1849), which also occur in the rocky 
intertidal zone (Behrens Yamada and Boulding 1996). Li. scutulata moves upshore in response 
to the presence of H. nudus and crushed conspecifics, where H. nudus density is lower (Keppel 
and Scrosati 2004). This suggests that H. nudus represents an ecologically significant predation 
threat to littorines.  
 
The thick shelled littorines are difficult prey for both H. nudus and H. oregonensis as 
neither crab species is a molluscivore specialists; they typically scrape or pick algae and softer 
invertebrates off rocks using their chelae (Behrens Yamada and Boulding 1996). Behrens 
Yamada and Boulding (1998) found that large H. nudus were capable of consuming Li. sitkana 
that were less than 8 mm in length, but had only a 37% success rate of consuming snails with 
lengths between 5.5-7 mm .  
I sought to investigate differences in propus size between between males and females of 
these two crab species. The size of the propus of the chela is positively correlated with the 
amount of force that can be produced due to greater musculature (Behrens Yamada and Boulding 
1998). A significant difference in propus size between the two species would suggest that further 
testing of character displacement may be warranted. A disparity in propus size to body size 
between male and female crabs might result in different feeding rates and shell breaking 
capabilities. I devised a test of preference by varying snail shell strength within the same size 
class. The snail species Li. scutulata and Lacuna vincta (Montagu 1803) are both in the family 
Charifson 4 
 
Littorinidae and have similar shell shape but different shell thickness. Lacuna vincta has a 
thinner, more fragile shell and is likely to be preferred as prey by shore crabs. I also hypothesize 
that, if chela size is held constant, female crabs will have greater snail consumption rates than 
male crabs. Female crabs with claws equivalent to males have a larger body mass,are likely to 
have greater metabolic need, and are less easily satiated. 
 
Study System: 
 
All specimens were collected on San Juan Island, Washington.  Two shore crabs (clade: 
Brachyura: Family Grapsidae), Hemigrapsus oregonensis  and Hemigrapsus nudus were 
collected in the intertidal adjacent to the Friday Harbor Laboratories dock. These closely related 
crabs are morphologically similar, but can be distinguished by the presence of purple spots on 
the cheliped of H. nudus and abundant setae on the pereopods of H. oregonensis (Kozloff 1987). 
Lacuna vincta, in the Class Gastropoda and Family Littoridae, were collected at False Bay and 
Dead Man Cove. Littorina scutulata, in the Class Gastropoda and Family Littoridae, were 
collected from the rocky intertidal zone of Fourth of July Beach.  
 
Materials and Methods: 
Morphometrics 
 
Male and females of H. oregonensis and H. nudus were measured with digital calipers 
(0.1 mm). Each crab was measured for carapace width, propal height and propal width. Carapace 
width was taken at the widest part of the carapace. Propal height was measured at the highest 
vertical distance along the propus. Propal width was measured perpendicular to propal height, 
from the left to right sides of the propus. All claw measurements were made on the left cheliped. 
Charifson 5 
 
If there was a size disparity between the left and right claws due to regeneration of a lost claw, 
the crab was excluded from the study. Ratios of carapace width:propal height (CW:PH) and 
carapace width:propal width (CW:PW) were calculated.  
 
Crab Feeding Preference 
 
Three female (Fe1, Fe2, Fe3) and three male (Ma1, Ma2, Ma3) crabs of H. nudus with 
propal heights between 5-6 mm were placed in small flow-through containers. Five L. scutulata 
and five L. vincta with shell lengths between 4-6 mm were added to each container. The ranges 
of crab propal height and snail shell length were chosen based on prior studies to ensure that the 
crabs were capable of feeding on the hard-shelled L. scutulata (Behrens Yamada and Boulding 
1998). H. oregonensis was excluded due to the rarity of female crabs of that species within the 
range of appropriate propal heights. After approximately 15 hours the number of L. scutulata and 
L. vincta consumed was counted. Three trials were conducted for each crab. 
Snail Consumption by Hemigrapsus nudus 
 
The crabs from the preference experiment were given five of each snail in each trial. 
After 1.5 to 3 hours the number of snails consumed was counted and converted to a consumption 
rate (snails consumed/hour). A total of eight feeding trials were conducted.  
 
Statistical Analysis 
 
For the morphometric analysis, crabs were divided into four groups based on sex and 
species. Standardized major axis regression was used to determine the relationship between crab 
morphometric parameters. Arcsin transformations were used to correct for non-normality (Sokol 
and Rohlf 2011). Differences in CW:PH and CW:PW were analyzed using a two-way ANOVA 
Charifson 6 
 
with factors: Sex and Species. Prey selection by H. nudus was analyzed using G-tests for each 
individual that consumed snails. An one-way ANOVA was used to determine differences in snail 
consumption rates by H. nudus.  
 
Results: 
Morphometrics: 
 
Carapace width was a good predictor of both propal height (Figure 1, Table 1A) and 
propal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was 
less variation in the relationship between carapace width and propal height than with propal 
width.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A 
significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, 
45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for 
CW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant 
sex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 
= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species 
respectively.  
 
Crab Feeding Preference:  
 
Expected values for both the number of L. scutulata and L. vincta consumed for the G-
test are 0.5 multiplied by the total number of snails consumed by each individual crab. G-tests 
for individual H. nudus that eat snails were all significant at p &lt; 0.001 with 1 degree of freedom 
(See Table 2 for statistical summary). The three crabs that did not eat either L. scutulata or L. 
vincta could not be tested for feeding preference.  
Charifson 7 
 
 
Snail Consumption by Hemigrapsus nudus 
 
No significant difference in crab feeding rate (snails consumed/hour) was found (F2, 21 = 
2.52, p = 0.104) among individual H. nudus that fed on snails during the course of the 
consumption experiment (Figure 5). Fe2  ate snails at a rate of 0.59±0.53 snails/hour (variance is 
standard deviation), Ma1 feeding rate was 0.24±0.31 snails/hour, and Ma2 had a feeding rate of 
0.80±0.38 snails/hour. Individuals Fe1, Fe3 and Ma3 did not consume any snails during the 
course of the experiment.  
 
Discussion: 
 
A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus 
and Hemigrapsus orogenensis. The variance in propal height or propal width explained by 
carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for 
propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela 
size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width 
respectively. The R2 values for propal width regressed against carapace width were consistently 
lower than propal height regressed against carapace width across species and sexes (Table 1). In 
general the ability of carapace width to explain the variance in chela size parameters (i.e.: R2 
values) was greater in females of both crab species (Table 1, Figures 1 and 2). Males may have 
more variation in claw size due to trade-offs between claw size and factors like feeding 
efficiency or resource allocation. Trade-offs relating to chela size are found in fiddler crabs, 
which exhibit extreme sexual dimorphism. Fiddler crabs have a trade-off between the intrasexual 
competition and intersexual signaling functions of the dimorphic claw (Swanson et al. 2013). 
Charifson 8 
 
This is not to say that the particular trade-offs in fiddler crabs case are analogous to that of 
Hemigrapsus, since both claws in the two shore crabs in this study are used in feeding.  
Sexual dimorphism in chela size, which is readily apparent to the eye in both 
Hemigrapsus nudus and Hemigrapsus oregonensis, was detected statistically (Figures 3 and 4). 
The two-way ANOVA with factors sex and species did not show a significant species effect, 
suggesting that the claws of both shore crabs produce roughly the same force and are 
functionally equivalent (Behrens Yamada and Boulding 1998). The lack of morphological 
difference in the size of the chelae between the crab species removes the possibility of character 
displacement in the trait. It should be noted that this study was not designed to test for character 
displacement, but to determine if this would be an interesting question for future investigations. 
To make a compelling case for character displacement it is necessary to compare multiple 
sympatric and allopatric populations with similar abiotic and biotic conditions (Stuart and Losos 
2013). Also it must be demonstrated that the trait differs due to genetic differences between 
sympatric and allopatric populations, that the differences between the populations are not due to 
species sorting, that the morphological trait is correlated to differences in resource use between 
the two sympatric species, and that the similar phenotype in allopatric populations compete for 
the same resources (Stuart and Losos 2013). The tendency of H. nudus to occupy the upper 
intertidal zone (Sliger 1987), despite considerable overlap with H. oregonensis, may provide 
enough differential resource use to prevent exclusion in sympatry. Desiccation tolerance may be 
a better trait to test for character displacement in these shore crabs.  
H. nudus males and females clearly preferred to eat the thinner shelled Lacuna vincta 
(Table 2). During the course of the feeding preference experiment all the crabs that ate snails 
consumed L. vincta exclusively. However, one Littorina scutuala was eaten by H. nudus when 
Charifson 9 
 
determining consumption rates. The six crabs were chosen because their claws were of 
appropriate size to eat littorines with shell length between 4-6 mm, yet only half of the crabs ate 
these snails. This could be due to insufficient time to acclimate H. nudus to lab conditions and 
possibly reduced feeding associated with molting. Male snow crabs, Chionoecetes opilio, were 
shown to cease feeding 3-6 weeks before and 3-4 weeks after molting (O’Halloran and O’Dor 
1988).  
It was my original intention to test for sex differences in consumption rates, but this was 
not possible as I could not collect many crabs of the appropriate claw size for gastropod feeding 
and many of the crabs I did collect did not feed. There were no statistically significant 
differences in consumption rates (snails eaten/hour) among the three feeding H. nudus. These 
individuals had highly variable feeding rates, mostly due to trials in which the crab did not feed. 
Sylvia Behrens Yamada and Elizabeth Boulding (1998) found that H. nudus consumed 1.8 
Littorina. sitkana/individual crab/day. In my study crabs fed on 13.03 Lacuna vincta/individual 
crab/ day. The greater consumption rate in my study is likely due to the easily breakable shells of 
La. vincta.  
The findings of this study suggest that there is no potential for character displacement of 
chela size in the sympatric H. nudus and H. oregonensis. This leaves the question of species co-
occurrence open to other possibilities. H. nudus has a strong preference for La. vincta, but it 
seems as if there have been no studies that show predation on La. vincta in the field. It should be 
noted that H. nudus and La. vincta usually occupy different portions of the intertidal and may 
have little contact with each other, unlike the relationship between H. nudus and Li. scutulata. 
There is some potential for overlap in the winter when La. vincta migrates up shore. Although no 
differences in consumption rates between male and female H. nudus were found, this might be 
Charifson 10 
 
due to logistical issues surrounding the experimental design and little replication. Future studies 
should include more crabs, the exclusion of non-feeding crabs, and trial periods with longer time 
intervals. Additionally, any subsequent study should utilize multivariate and geometric 
morphometric methods to quantify claw shape instead of using ratios, as two similar ratios may 
have different shape.  
 
Acknowledgements: 
 
I would like to thank Dianna Padilla, Michael LaBarbera, and Kevin Turner for advice 
relating to the experimental design of this study. I would also like to thank the director and staff 
of Friday Harbor Laboratories for use of facilities and permission to collect organisms. Friday 
Harbor Laboratories, The Libbie Hyman Scholarship, Society for Integrative and Comparative 
Biology, and the Stony Brook Department of Ecology and Evolution provided financial support 
and have my gratitude.  
 
 
 
 
 
 
 
 
 
 
Charifson 12 
 
Swanson, B. O., George, M. N., Anderson, S. T., and Christy, J. H. 2013. Evolutionary variation
 
in the mechanics of fiddler crab claws. BMC Evolutionary Biology 13: 137. 
 
 
 
 
 
 
 
 
 
Charifson 13 
 
Table 1: SMA regressions of carapace width and propus measures.  
A) The relationship between carapace width and propal height. x is carapace width and y is 
propal height. B) The relationship between carapace width and propal height. x is carapace width 
and y is propal width.  
 
 
 
SMA Regression  
 
A 
 
N 
Carapace Width vs Propal Height  
R2 
 
Female H. nudus 
13 
y = 0.273*x - 0.678 
0.976 
 
Male H. nudus 
13 
y = 0.311*x - 1.385 
0.868 
 
Female H. oregonensis 
9 
y = 0.351*x - 0.833 
0.894 
 
Male H. oregonensis 
14 
y = 0.39*x - 1.149 
0.693 
 
 
 
 
 
 
 
 
SMA Regression  
 
B 
 
N 
Carapace Width vs Propal Width  
R2 
 
Female H. nudus 
13 
y = 0.157*x - 0.386 
0.927 
 
Male H. nudus 
13 
y = 0.209*x - 1.288 
0.859 
 
Female H. oregonensis 
9 
y = 0.175*x + 0.037 
0.724 
 
Male H. oregonensis 
14 
y = 0.244*x - 0.688 
0.534 
 
 
Charifson 14 
 
Table 2: Size and prey preference in H. nudus.  
Size parameters of experimental Hemigrapsus nudus and number of prey consumed in 24 hour 
intervals (three trials). Crabs Fe1, Fe3, and Ma3 did not feed on snails and were not testable (NT) 
for preference. 
Individual 
Carapace 
Width (mm) 
Propal 
Height (mm) 
Number of 
Lacuna vincta 
consumed 
Number of 
Littorina scutulata 
consumed 
 
G 
 
p-value 
Fe1 
23.6 
5.9 
0 
0 
NT 
 
Fe2 
23.1 
5.5 
15 
0 
20.8 
p &lt; 0.001 
Fe3 
20.6 
5 
0 
0 
NT 
 
Ma1 
19.1 
5.4 
14 
0 
19.4 
p &lt; 0.001 
Ma2 
18.4 
5.4 
15 
0 
20.8 
p &lt; 0.001 
Ma3 
20.1 
6 
0 
0 
NT 
 
 
 
 
Charifson 15 
 
 
Figure 1: Relationship of carapace width and propal height in Hemigrapsus. Line of best fit from 
SMA regression. See Table 1A for descriptive statistics. A) Female H. nudus. B) Male H. nudus. 
C) Female H. oregonensis. D) Male H. oregonensis.  
 
 
 
Charifson 16 
 
 
Figure 2: Relationship of carapace width and propal width in Hemigrapsus.  
Line of best fit from SMA regression. See Table 1B for descriptive statistics. A) Female H. 
nudus. B) Male H. nudus. C)Female H. oregonensis. D) Male H. oregonensis.  
 
 
 
Charifson 17 
 
 
Figure 3: Differences in propal height:carapace width ratio between sex and species. 
The sex factor was statistically significant (F = 125.6. p &lt; 0.001), while the species factor was 
insignificant (F &gt; 0.01, p = 0.983). There was a significant interaction (F = 4.39, p = 0.042). 
Error bars represent standard error of the mean.  
 
 
 
0 
0.05 
0.1 
0.15 
0.2 
0.25 
0.3 
0.35 
H. nudus 
H. oregonensis 
Propal Height:Carapace Width 
Crab Species 
Female 
Male 
Charifson 18 
 
 
Figure 4: Differences in propal width:carapace width ratio between sex and species. 
The sex factor was statistically significant (F1,45 = 103.8. p &lt; 0.001), while the species factor was 
insignificant (F1,45  = 0.09, p = 0.764). There was a significant interaction (F1,45  = 7.19, p = 
0.01). Error bars represent standard error of the mean.  
 
 
 
0 
0.05 
0.1 
0.15 
0.2 
0.25 
H. nudus 
H. oregonensis 
Propal Widtht:Carapace Width 
Crab Species 
Female 
Male 
Charifson 19 
 
 
Figure 5: Consumption rates by individual H. nudus.  
Mean consumption rates (n = 8 trials) of 3 female (Fe1 to Fe3) and 3 male (Ma1 to Ma3) H. 
nudus. Crabs Fe1, Fe3, and Ma3 did not consume snails. The individuals that eat snails did not 
differ in their consumption rates (F2,21  = 2.52, p = 0.104). Error bars represent standard error of 
the mean.  
  
0 
0.1 
0.2 
0.3 
0.4 
0.5 
0.6 
0.7 
0.8 
0.9 
1 
Fe1 
Fe2 
Fe3 
Ma1 
Ma2 
Ma3 
Mean Consumption Rate  
(Snails Consumed/Hour) 
Individual H. nudus 
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tk_text_splitter <span class="op">=</span> TokenTextSplitter(chunk_size <span class="op">=</span> <span class="dv">800</span>, chunk_overlap <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> tk_text_splitter.split_text(new_pdf_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Initialize Embeddings</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>embeddings <span class="op">=</span> OpenAIEmbeddings()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>vector_store <span class="op">=</span> FAISS.from_texts(docs, embeddings).as_retriever(search_type <span class="op">=</span> <span class="st">"similarity"</span>, search_kwargs<span class="op">=</span> {<span class="st">"k"</span>: <span class="dv">3</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> ChatOpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model_name<span class="op">=</span><span class="st">'gpt-3.5-turbo'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>compressor <span class="op">=</span> LLMChainExtractor.from_llm(llm)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>compression_retriever <span class="op">=</span> ContextualCompressionRetriever(base_compressor <span class="op">=</span> compressor,base_retriever<span class="op">=</span>vector_store)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>custom_template <span class="op">=</span> <span class="st">"""Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question. Please use a maximum of 4 sentences. If you do not know the answer reply with 'I am sorry'.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">1. SPECIES NAME: The scientific name (species name) of any plant, animal, fungus, alga or bacterium consists of two Latinized words. The first word is the name of the genus to which the organism belongs. The second word is the specific epithet or specific term of the species. Together, the genus plus the specific epithet make up the species name. The species name and scientific name are synonyms.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">2. HABITAT: A species habitat can be seen as the physical manifestation of its ecological niche.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">3. LOC: Name of any geographic location, like cities, countries, continents, districts etc.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">1. Sentence: Strongylocentrotus fransiscanus and S. purpuratus were obtained from the subtidal and intertidal regions, respectively, of Monterey Bay.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">"Output: </span><span class="sc">{{</span><span class="st">'SPECIES NAME': ['Strongylocentrotus fransiscanus', 'S. purpuratus'], 'HABITAT': ['subtidal', 'intertidal'], 'LOC': ['Monterey Bay']</span><span class="sc">}}</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="st">2. Sentence: Cucumaria curata and C. pseudocurata live and feed in the hydrodynamically stressful environment of exposed intertidal areas.</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: </span><span class="sc">{{</span><span class="st">'SPECIES NAME': ['Cucumaria curata', 'C. pseudocurata'], 'HABITAT': ['exposed intertidal'], 'LOC': ['None']</span><span class="sc">}}</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="st">Chat History:</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="sc">{chat_history}</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="st">Follow Up Input: </span><span class="sc">{question}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>CUSTOM_QUESTION_PROMPT <span class="op">=</span> PromptTemplate.from_template(custom_template)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>memory <span class="op">=</span> VectorStoreRetrieverMemory(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>memory_key<span class="op">=</span><span class="st">"chat_history"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>return_docs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>retriever<span class="op">=</span>vector_store,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>return_messages<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Formats the chat history string</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_chat_history(inputs) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> []</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> human, ai <span class="kw">in</span> inputs:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        res.append(<span class="ss">f"Human:</span><span class="sc">{</span>human<span class="sc">}</span><span class="ch">\n</span><span class="ss">AI:</span><span class="sc">{</span>ai<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>qa_chain <span class="op">=</span> ConversationalRetrievalChain.from_llm(ChatOpenAI(), </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                                 compression_retriever,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                                 memory <span class="op">=</span> memory,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                                 return_source_documents <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                                 condense_question_prompt <span class="op">=</span> CUSTOM_QUESTION_PROMPT,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                                 get_chat_history <span class="op">=</span> get_chat_history)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"What is this paper about?"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>query1a <span class="op">=</span> <span class="st">"What were the significant findings on the relationship mentioned?"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>query2 <span class="op">=</span> <span class="st">"Summarize the paper concisely with reference to materials and methods."</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>query3 <span class="op">=</span> <span class="st">"Write a one sentence summary of the purpose of the paper"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>query4 <span class="op">=</span> <span class="st">"Terms that may be used to identify an observation include “in the field”, “this study”, “observed”, “taken”, “collected”, “sampled”, “collection”, “seen”, “harvested”, “found”, etc. Does the paper include one or more observations?"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>query5 <span class="op">=</span> <span class="st">"Does this paper contain observational or experimental research conducted in the natural environment or with organisms collected in nature?"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>query6 <span class="op">=</span> <span class="st">"What are the scientific names of the collected species mentioned in this paper?"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>query6a <span class="op">=</span> <span class="st">"Where were the species collected?"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>query7 <span class="op">=</span> <span class="st">"Does the paper mention where the species were observed or collected, and if so, what locations are given?"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>query7a <span class="op">=</span> <span class="st">"Please list the species collected based on their scientific names along with location of collection."</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>query8 <span class="op">=</span> <span class="st">"Can you give a more specific location?"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>query9 <span class="op">=</span> <span class="st">"Are any coordinate locations given in latitude / longitude, and if so, what are they?"</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>query10 <span class="op">=</span> <span class="st">"In what habitat were the species found?"</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>query10a <span class="op">=</span> <span class="st">"Can you give a more specific location of the habitat such as formal name of said location?"</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>query11 <span class="op">=</span> <span class="st">"Does the paper mention a year, date and/or time that species were collected or observed, and if so, what was mentioned?"</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>query12 <span class="op">=</span> <span class="st">"Are there any maps, figures, tables or diagrams in the paper?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>chat_history <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span> qa_chain({<span class="st">"question"</span>: query, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\aclao89\AppData\Local\anaconda3\lib\site-packages\langchain\chains\llm.py:275: UserWarning: The predict_and_parse method is deprecated, instead pass an output parser directly to LLMChain.
  warnings.warn(</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>result1[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>'The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>result1[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>[Document(page_content='Mean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus', metadata={}),
 Document(page_content='A multitude of species coexist in the marine intertidal environment. Closely related \nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \nconsiderable habitat overlap between these two species; the underside of a single rock may have \nCharifson 3 \n \nroughly equal abundances of the two crab species (personal observation). The size of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization.', metadata={}),
 Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1). In general the ability of carapace width to explain the variance in chela size parameters (i.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>result1[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>[Document(page_content='8 \n0.9 \n1 \nFe1 \nFe2 \nFe3 \nMa1 \nMa2 \nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus \n', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.  \n \nCrab Feeding Preference:  \n \nExpected values for both the number of L. scutulata and L. vincta consumed for the G-\ntest are 0.5 multiplied by the total number of snails consumed by each individual crab. G-tests \nfor individual H. nudus that eat snails were all significant at p &lt; 0.001 with 1 degree of freedom \n(See Table 2 for statistical summary). The three crabs that did not eat either L. scutulata or L. \nvincta could not be tested for feeding preference.  \nCharifson 7 \n \n \nSnail Consumption by Hemigrapsus nudus \n \nNo significant difference in crab feeding rate (snails consumed/hour) was found (F2, 21 = \n2.52, p = 0.104) among individual H. nudus that fed on snails during the course of the \nconsumption experiment (Figure 5). Fe2  ate snails at a rate of 0.59±0.53 snails/hour (variance is \nstandard deviation), Ma1 feeding rate was 0.24±0.31 snails/hour, and Ma2 had a feeding rate of \n0.80±0.38 snails/hour. Individuals Fe1, Fe3 and Ma3 did not consume any snails during the \ncourse of the experiment.  \n \nDiscussion: \n \nA few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus \nand Hemigrapsus orogenensis. The variance in propal height or propal width explained by \ncarapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for \npropal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela \nsize parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width \nrespectively. The R2 values for propal width regressed against carapace width were consistently \nlower than propal height regressed against carapace width across species and sexes (Table 1). In \ngeneral the ability of carapace width to explain the variance in chela size parameters (i.', metadata={}),
 Document(page_content='Charifson 1 \n \nSnail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species \nDifferences in Chela Size. \n \nDavid Charifson1,2 \n \nMarine Invertebrate Zoology \nSummer 2014 \n \n \n \n \n1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250 \n2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794-5245 \n \n \n \n \nContact information: \nDavid Charifson \nDepartment of Ecology and Evolution \nStony Brook University \n650 Life Sciences Building \nStony Brook, NY 11794-5245 \nDavid.charifson@stonybrook.edu  \n \n \n \n \nKeywords: Hemigrapsus nudus, Hemigrapsus orogenensis, Littorina scutulata, Lacuna vincta, \npredation, sexual dimorphism, character displacement  \n \n \nCharifson 2 \n \nAbstract: \n \nThe relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.  \n \nIntroduction: \n \nA multitude of species coexist in the marine intertidal environment. Closely related \nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \nconsiderable habitat overlap between these two species; the underside of a single rock may have \nCharifson 3 \n \nroughly equal abundances of the two crab species (personal observation). The size of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization. \nBoth species are omnivores that eat algae and small invertebrates, including snails \n(Behrens Yamada and', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>result1a <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query1a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>result1a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>'The significant findings on the relationship between carapace width and propal height and width in Hemigrapsus are as follows:\n\n1. Carapace width was a good predictor of both propal height and propal width in female and male H. oregonensis and H. nudus.\n\n2. There was less variation in the relationship between carapace width and propal height than with propal width.\n\n3. A significant effect for sex was found for both carapace width:propal height (CW:PH) and carapace width:propal width (CW:PW). \n\n4. There was no significant difference between Hemigrapsus species for CW:PH and CW:PW.\n\n5. A significant sex*species interaction was detected for both CW:PH and CW:PW.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>result1a[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>[Document(page_content='Figure 1: Relationship of carapace width and propal height in Hemigrapsus. Line of best fit from \nSMA regression. See Table 1A for descriptive statistics. A) Female H. nudus. B) Male H. nudus. \nC) Female H. oregonensis. D) Male H. oregonensis.  \n\nFigure 2: Relationship of carapace width and propal width in Hemigrapsus.  \nLine of best fit from SMA regression. See Table 1B for descriptive statistics. A) Female H. \nnudus. B) Male H. nudus. C)Female H. oregonensis. D) Male H. oregonensis.  \n\nFigure 3: Differences in propal height:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F = 125.6. p &lt; 0.001), while the species factor was \ninsignificant (F &gt; 0.01, p = 0.983). There was a significant interaction (F = 4.39, p = 0.042). \nError bars represent standard error of the mean.  \n\nFigure 4: Differences in propal width:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F1,45 = 103.8. p &lt; 0.001), while the species factor was \ninsignificant (F1,45  = 0.09, p = 0.764). There was a significant interaction (F1,45  = 7.19, p = \n0.01). Error bars represent standard error of the mean.', metadata={}),
 Document(page_content='Table 1: SMA regressions of carapace width and propus measures.  \nA) The relationship between carapace width and propal height. x is carapace width and y is \npropal height. B) The relationship between carapace width and propal height. x is carapace width \nand y is propal width.  \n\nSMA Regression  \n\nA \n\nN \nCarapace Width vs Propal Height  \nR2 \n\nFemale H. nudus \n13 \ny = 0.273*x - 0.678 \n0.976 \n\nMale H. nudus \n13 \ny = 0.311*x - 1.385 \n0.868 \n\nFemale H. oregonensis \n9 \ny = 0.351*x - 0.833 \n0.894 \n\nMale H. oregonensis \n14 \ny = 0.39*x - 1.149 \n0.693 \n\nSMA Regression  \n\nB \n\nN \nCarapace Width vs Propal Width  \nR2 \n\nFemale H. nudus \n13 \ny = 0.157*x - 0.386 \n0.927 \n\nMale H. nudus \n13 \ny = 0.209*x - 1.288 \n0.859 \n\nFemale H. oregonensis \n9 \ny = 0.175*x + 0.037 \n0.724 \n\nMale H. oregonensis \n14 \ny = 0.244*x - 0.688 \n0.534 \n\nTable 2: Size and prey preference in H. nudus.  \nSize parameters of experimental Hemigrapsus nudus and number of prey consumed in 24 hour \nintervals (three trials). Crabs Fe1, Fe3, and Ma3 did not feed on snails and were not testable (NT) \nfor preference. \nIndividual \nCarapace \nWidth (mm) \nPropal \nHeight (mm) \nNumber of \nLacuna vincta \nconsumed \nNumber of \nLittorina scutulata \nconsumed \n\nG \n\np-value \nFe1 \n23.6 \n5.9 \n0 \n0 \nNT \n\nFe2 \n23.1 \n5.5 \n15 \n0 \n20.8 \np &lt; 0.001 \nFe3 \n20.6 \n5 \n0 \n0 \nNT \n\nMa1 \n19.1 \n5.4 \n14 \n0 \n19.4 \np &lt; 0.001 \nMa2 \n18.4 \n5.4 \n15 \n0 \n20.8 \np &lt; 0.001 \nMa3 \n20.1 \n6 \n0 \n0 \nNT \n\nFigure 1: Relationship of carapace width and propal height in Hemigrapsus. Line', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth. A significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>result1a[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>[Document(page_content=' \n0 \n0 \nNT \n \n \n \n \nCharifson 15 \n \n \nFigure 1: Relationship of carapace width and propal height in Hemigrapsus. Line of best fit from \nSMA regression. See Table 1A for descriptive statistics. A) Female H. nudus. B) Male H. nudus. \nC) Female H. oregonensis. D) Male H. oregonensis.  \n \n \n \nCharifson 16 \n \n \nFigure 2: Relationship of carapace width and propal width in Hemigrapsus.  \nLine of best fit from SMA regression. See Table 1B for descriptive statistics. A) Female H. \nnudus. B) Male H. nudus. C)Female H. oregonensis. D) Male H. oregonensis.  \n \n \n \nCharifson 17 \n \n \nFigure 3: Differences in propal height:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F = 125.6. p &lt; 0.001), while the species factor was \ninsignificant (F &gt; 0.01, p = 0.983). There was a significant interaction (F = 4.39, p = 0.042). \nError bars represent standard error of the mean.  \n \n \n \n0 \n0.05 \n0.1 \n0.15 \n0.2 \n0.25 \n0.3 \n0.35 \nH. nudus \nH. oregonensis \nPropal Height:Carapace Width \nCrab Species \nFemale \nMale \nCharifson 18 \n \n \nFigure 4: Differences in propal width:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F1,45 = 103.8. p &lt; 0.001), while the species factor was \ninsignificant (F1,45  = 0.09, p = 0.764). There was a significant interaction (F1,45  = 7.19, p = \n0.01). Error bars represent standard error of the mean.  \n \n \n \n0 \n0.05 \n0.1 \n0.15 \n0.2 \n0.25 \nH. nudus \nH. oregonensis \nPropal Widtht:Carapace Width \nCrab Species \nFemale \nMale \nCharifson 19 \n \n \nFigure 5: Consumption rates by individual H. nudus.  \nMean consumption rates (n = 8 trials) of 3 female (Fe1 to Fe3) and 3 male (Ma1 to Ma3) H. \nnudus. Crabs Fe1, Fe3, and Ma3 did not consume snails. The individuals that eat snails did not \ndiffer in their consumption rates (F2,21  = 2.52, p = 0.104). Error bars represent standard error of \nthe mean.  \n  \n0 \n0.1 \n0.2 \n0.3 \n0.4 \n0.5 \n0.6 \n0.7 \n0.8 \n0.9 \n1 \nFe1 \nFe2 \nFe3 \nMa1 \nMa2 \nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour)', metadata={}),
 Document(page_content=' \n \n \n \n \n \nCharifson 13 \n \nTable 1: SMA regressions of carapace width and propus measures.  \nA) The relationship between carapace width and propal height. x is carapace width and y is \npropal height. B) The relationship between carapace width and propal height. x is carapace width \nand y is propal width.  \n \n \n \nSMA Regression  \n \nA \n \nN \nCarapace Width vs Propal Height  \nR2 \n \nFemale H. nudus \n13 \ny = 0.273*x - 0.678 \n0.976 \n \nMale H. nudus \n13 \ny = 0.311*x - 1.385 \n0.868 \n \nFemale H. oregonensis \n9 \ny = 0.351*x - 0.833 \n0.894 \n \nMale H. oregonensis \n14 \ny = 0.39*x - 1.149 \n0.693 \n \n \n \n \n \n \n \n \nSMA Regression  \n \nB \n \nN \nCarapace Width vs Propal Width  \nR2 \n \nFemale H. nudus \n13 \ny = 0.157*x - 0.386 \n0.927 \n \nMale H. nudus \n13 \ny = 0.209*x - 1.288 \n0.859 \n \nFemale H. oregonensis \n9 \ny = 0.175*x + 0.037 \n0.724 \n \nMale H. oregonensis \n14 \ny = 0.244*x - 0.688 \n0.534 \n \n \nCharifson 14 \n \nTable 2: Size and prey preference in H. nudus.  \nSize parameters of experimental Hemigrapsus nudus and number of prey consumed in 24 hour \nintervals (three trials). Crabs Fe1, Fe3, and Ma3 did not feed on snails and were not testable (NT) \nfor preference. \nIndividual \nCarapace \nWidth (mm) \nPropal \nHeight (mm) \nNumber of \nLacuna vincta \nconsumed \nNumber of \nLittorina scutulata \nconsumed \n \nG \n \np-value \nFe1 \n23.6 \n5.9 \n0 \n0 \nNT \n \nFe2 \n23.1 \n5.5 \n15 \n0 \n20.8 \np &lt; 0.001 \nFe3 \n20.6 \n5 \n0 \n0 \nNT \n \nMa1 \n19.1 \n5.4 \n14 \n0 \n19.4 \np &lt; 0.001 \nMa2 \n18.4 \n5.4 \n15 \n0 \n20.8 \np &lt; 0.001 \nMa3 \n20.1 \n6 \n0 \n0 \nNT \n \n \n \n \nCharifson 15 \n \n \nFigure 1: Relationship of carapace width and propal height in Hemigrapsus. Line', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.  \n \nCrab Feeding Preference:  \n \nExpected values for both the number of L. scutulata and L. vincta consumed for the G-\ntest are 0.5 multiplied by the total number of snails consumed by each individual crab. G-tests \nfor individual H. nudus that eat snails were all significant at p &lt; 0.001 with 1 degree of freedom \n(See Table 2 for statistical summary). The three crabs that did not eat either L. scutulata or L. \nvincta could not be tested for feeding preference.  \nCharifson 7 \n \n \nSnail Consumption by Hemigrapsus nudus \n \nNo significant difference in crab feeding rate (snails consumed/hour) was found (F2, 21 = \n2.52, p = 0.104) among individual H. nudus that fed on snails during the course of the \nconsumption experiment (Figure 5). Fe2  ate snails at a rate of 0.59±0.53 snails/hour (variance is \nstandard deviation), Ma1 feeding rate was 0.24±0.31 snails/hour, and Ma2 had a feeding rate of \n0.80±0.38 snails/hour. Individuals Fe1, Fe3 and Ma3 did not consume any snails during the \ncourse of the experiment.  \n \nDiscussion: \n \nA few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus \nand Hemigrapsus orogenensis. The variance in propal height or propal width explained by \ncarapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for \npropal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela \nsize parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width \nrespectively. The R2 values for propal width regressed against carapace width were consistently \nlower than propal height regressed against carapace width across species and sexes (Table 1). In \ngeneral the ability of carapace width to explain the variance in chela size parameters (i.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>result2 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query2, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>result2[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>'The paper focuses on the study of snail predation by Hemigrapsus nudus and Hemigrapsus oregonensis, specifically examining sex and species differences in chela size. The materials and methods involved the measurement of carapace width and propal width in both female and male H. nudus. A line of best fit was determined using SMA regression. The propal height:carapace width ratio and propal width:carapace width ratio were analyzed to determine differences between sexes and species. The preference experiment involved providing crabs with five snails in each trial and measuring the number of snails consumed after 1.5 to 3 hours, which was then converted to a consumption rate. A total of eight feeding trials were conducted.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>result2[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>[Document(page_content='The main topic of this paper is the study of snail predation by Hemigrapsus nudus and Hemigrapsus oregonensis, specifically examining sex and species differences in chela size.', metadata={}),
 Document(page_content='Figure 2: The relationship between carapace width and propal width in Hemigrapsus:\n   - For both female and male H. nudus, a line of best fit was determined using SMA regression.\n   - Descriptive statistics for this relationship can be found in Table 1B.\n\nFigure 3: Differences in propal height:carapace width ratio between sex and species:\n   - The sex factor was statistically significant (F = 125.6, p &lt; 0.001), indicating that there is a significant difference in propal height:carapace width ratio between males and females.\n   - The species factor was insignificant (F &gt; 0.01, p = 0.983), suggesting that there is no significant difference in propal height:carapace width ratio between H. oregonensis and H. nudus.\n   - There was a significant interaction (F = 4.39, p = 0.042), indicating that the effect of sex on propal height:carapace width ratio may vary depending on the species.\n\nFigure 4: Differences in propal width:carapace width ratio between sex and species:\n   - The sex factor was statistically significant (F1,45 = 103.8, p &lt; 0.001), indicating that there is a significant difference in propal width:carapace width ratio between males and females.\n   - The species factor was insignificant (F1,45 = 0.09, p = 0.764), suggesting that there is no significant difference in propal width:carapace width ratio between H. oregonensis and H. nudus.\n   - There was a significant interaction (F1,45 = 7.19, p = 0.01), indicating that the effect of sex on propal width:carapace width ratio may vary depending on the species.', metadata={}),
 Document(page_content='The crabs from the preference experiment were given five of each snail in each trial. \nAfter 1.5 to 3 hours the number of snails consumed was counted and converted to a consumption \nrate (snails consumed/hour). A total of eight feeding trials were conducted.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>result2[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>[Document(page_content='question: What is this paper about?\nanswer: The main topic of this paper is the study of snail predation by Hemigrapsus nudus and Hemigrapsus oregonensis, specifically examining sex and species differences in chela size.\nsource_documents: [Document(page_content=\'The main topic or subject of this paper is the "Snail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species Differences in Chela Size."\', metadata={})]', metadata={}),
 Document(page_content="question: What were the significant findings on the relationship mentioned?\nanswer: From the given information, we can determine the following significant findings:\n\n1. Figure 2: The relationship between carapace width and propal width in Hemigrapsus:\n   - For both female and male H. nudus, a line of best fit was determined using SMA regression.\n   - Descriptive statistics for this relationship can be found in Table 1B.\n\n2. Figure 3: Differences in propal height:carapace width ratio between sex and species:\n   - The sex factor was statistically significant (F = 125.6, p &lt; 0.001), indicating that there is a significant difference in propal height:carapace width ratio between males and females.\n   - The species factor was insignificant (F &gt; 0.01, p = 0.983), suggesting that there is no significant difference in propal height:carapace width ratio between H. oregonensis and H. nudus.\n   - There was a significant interaction (F = 4.39, p = 0.042), indicating that the effect of sex on propal height:carapace width ratio may vary depending on the species.\n\n3. Figure 4: Differences in propal width:carapace width ratio between sex and species:\n   - The sex factor was statistically significant (F1,45 = 103.8, p &lt; 0.001), indicating that there is a significant difference in propal width:carapace width ratio between males and females.\n   - The species factor was insignificant (F1,45 = 0.09, p = 0.764), suggesting that there is no significant difference in propal width:carapace width ratio between H. oregonensis and H. nudus.\n   - There was a significant interaction (F1,45 = 7.19, p = 0.01), indicating that the effect of sex on propal width:carapace width ratio may vary depending on the species.\nsource_documents: [Document(page_content='Figure 2: Relationship of carapace width and propal width in Hemigrapsus.  \\nLine of best fit from SMA regression. See Table 1B for descriptive statistics. A) Female H. \\nnudus. B) Male H. nudus. C)Female H. oregonensis. D) Male H. oregonensis.  \\n\\nFigure 3: Differences in propal height:carapace width ratio between sex and species. \\nThe sex factor was statistically significant (F = 125.6. p &lt; 0.001), while the species factor was \\ninsignificant (F &gt; 0.01, p = 0.983). There was a significant interaction (F = 4.39, p = 0.042). \\nError bars represent standard error of the mean.  \\n\\nFigure 4: Differences in propal width:carapace width ratio between sex and species. \\nThe sex factor was statistically significant (F1,45 = 103.8. p &lt; 0.001), while the species factor was \\ninsignificant (F1,45  = 0.09, p = 0.764). There was a significant interaction (F1,45  = 7.19, p = \\n0.01). Error bars represent standard error of the mean.', metadata={}), Document(page_content='Table 2: Size and prey preference in H. nudus.  \\nSize parameters of experimental Hemigrapsus nudus and number of prey consumed in 24 hour \\nintervals (three trials). Crabs Fe1, Fe3, and Ma3 did not feed on snails and were not testable (NT) \\nfor preference. \\nIndividual \\nCarapace \\nWidth (mm) \\nPropal \\nHeight (mm) \\nNumber of \\nLacuna vincta \\nconsumed \\nNumber of \\nLittorina scutulata \\nconsumed \\n \\nG \\n \\np-value \\nFe1 \\n23.6 \\n5.9 \\n0 \\n0 \\nNT \\n \\nFe2 \\n23.1 \\n5.5 \\n15 \\n0 \\n20.8 \\np &lt; 0.001 \\nFe3 \\n20.6 \\n5 \\n0 \\n0 \\nNT \\n \\nMa1 \\n19.1 \\n5.4 \\n14 \\n0 \\n19.4 \\np &lt; 0.001 \\nMa2 \\n18.4 \\n5.4 \\n15 \\n0 \\n20.8 \\np &lt; 0.001 \\nMa3 \\n20.1 \\n6 \\n0 \\n0 \\nNT', metadata={})]", metadata={}),
 Document(page_content='\nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus \n', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>result3 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query3, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>result3[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>'The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>result3[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>[Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth. A significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>result3[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>[Document(page_content="question: What is this paper about?\nanswer: The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.\nsource_documents: [Document(page_content='Mean Consumption Rate  \\n(Snails Consumed/Hour) \\nIndividual H. nudus', metadata={}), Document(page_content='A multitude of species coexist in the marine intertidal environment. Closely related \\nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \\nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \\nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \\nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \\nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \\nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \\nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \\nconsiderable habitat overlap between these two species; the underside of a single rock may have \\nCharifson 3 \\n \\nroughly equal abundances of the two crab species (personal observation). The size of the chela \\nmay differ, which could allow the crabs to differentiate in food resource utilization.', metadata={}), Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1). In general the ability of carapace width to explain the variance in chela size parameters (i.', metadata={})]", metadata={}),
 Document(page_content='8 \n0.9 \n1 \nFe1 \nFe2 \nFe3 \nMa1 \nMa2 \nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus \n', metadata={}),
 Document(page_content='Charifson 1 \n \nSnail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species \nDifferences in Chela Size. \n \nDavid Charifson1,2 \n \nMarine Invertebrate Zoology \nSummer 2014 \n \n \n \n \n1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250 \n2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794-5245 \n \n \n \n \nContact information: \nDavid Charifson \nDepartment of Ecology and Evolution \nStony Brook University \n650 Life Sciences Building \nStony Brook, NY 11794-5245 \nDavid.charifson@stonybrook.edu  \n \n \n \n \nKeywords: Hemigrapsus nudus, Hemigrapsus orogenensis, Littorina scutulata, Lacuna vincta, \npredation, sexual dimorphism, character displacement  \n \n \nCharifson 2 \n \nAbstract: \n \nThe relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.  \n \nIntroduction: \n \nA multitude of species coexist in the marine intertidal environment. Closely related \nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \nconsiderable habitat overlap between these two species; the underside of a single rock may have \nCharifson 3 \n \nroughly equal abundances of the two crab species (personal observation). The size of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization. \nBoth species are omnivores that eat algae and small invertebrates, including snails \n(Behrens Yamada and', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>query3a <span class="op">=</span> <span class="st">"Since the crabs were feeding on snails, what were the scientific names of the snails?"</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>result3a <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query3a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>result3a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>'The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.'</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>result3a[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>[Document(page_content='Littorina scutulata (Gould 1849) and Littorina sitkana (Philippi 1846)', metadata={}),
 Document(page_content='Hemigrapsus nudus, Hemigrapsus oregonensis, Littorina scutulata, Lacuna vincta', metadata={}),
 Document(page_content='Hemigrapsus nudus and Hemigrapsus oregonensis', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>result3a[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[Document(page_content=' of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization. \nBoth species are omnivores that eat algae and small invertebrates, including snails \n(Behrens Yamada and Boulding 1996). The two shore crab species are known to eat Littorina \nsitkana (Philippi 1846) and Littorina scutulata (Gould 1849), which also occur in the rocky \nintertidal zone (Behrens Yamada and Boulding 1996). Li. scutulata moves upshore in response \nto the presence of H. nudus and crushed conspecifics, where H. nudus density is lower (Keppel \nand Scrosati 2004). This suggests that H. nudus represents an ecologically significant predation \nthreat to littorines.  \n \nThe thick shelled littorines are difficult prey for both H. nudus and H. oregonensis as \nneither crab species is a molluscivore specialists; they typically scrape or pick algae and softer \ninvertebrates off rocks using their chelae (Behrens Yamada and Boulding 1996). Behrens \nYamada and Boulding (1998) found that large H. nudus were capable of consuming Li. sitkana \nthat were less than 8 mm in length, but had only a 37% success rate of consuming snails with \nlengths between 5.5-7 mm .  \nI sought to investigate differences in propus size between between males and females of \nthese two crab species. The size of the propus of the chela is positively correlated with the \namount of force that can be produced due to greater musculature (Behrens Yamada and Boulding \n1998). A significant difference in propus size between the two species would suggest that further \ntesting of character displacement may be warranted. A disparity in propus size to body size \nbetween male and female crabs might result in different feeding rates and shell breaking \ncapabilities. I devised a test of preference by varying snail shell strength within the same size \nclass. The snail species Li. scutulata and Lacuna vincta (Montagu 1803) are both in the family \nCharifson 4 \n \nLittorinidae and have similar shell shape but different shell thickness. Lacuna vincta has a \nthinner, more fragile shell and is likely to be preferred as prey by shore crabs. I also hypothesize \nthat, if chela size is held constant, female crabs will have greater snail consumption rates than \nmale crabs. Female crabs with claws equivalent to males have a larger body mass,are likely to \nhave greater metabolic need, and are less easily satiated. \n \nStudy System: \n \nAll specimens were collected on San Juan Island, Washington.  Two shore crabs (clade: \nBrachyura: Family Grapsidae), Hemigrapsus oregonensis  and Hemigrapsus nudus were \ncollected in the intertidal adjacent to the Friday Harbor Laboratories dock. These closely related \ncrabs are morphologically similar, but can be distinguished by the presence of purple spots on \nthe cheliped of H. nudus and abundant setae on the pereopods of H. oregonensis (Kozloff 1987). \nLacuna vincta, in the Class Gastropoda and Family Littoridae, were collected at False Bay and \nDead Man Cove. Littorina scutulata, in the Class Gastropoda and Family Littor', metadata={}),
 Document(page_content='Charifson 1 \n \nSnail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species \nDifferences in Chela Size. \n \nDavid Charifson1,2 \n \nMarine Invertebrate Zoology \nSummer 2014 \n \n \n \n \n1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250 \n2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794-5245 \n \n \n \n \nContact information: \nDavid Charifson \nDepartment of Ecology and Evolution \nStony Brook University \n650 Life Sciences Building \nStony Brook, NY 11794-5245 \nDavid.charifson@stonybrook.edu  \n \n \n \n \nKeywords: Hemigrapsus nudus, Hemigrapsus orogenensis, Littorina scutulata, Lacuna vincta, \npredation, sexual dimorphism, character displacement  \n \n \nCharifson 2 \n \nAbstract: \n \nThe relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.  \n \nIntroduction: \n \nA multitude of species coexist in the marine intertidal environment. Closely related \nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \nconsiderable habitat overlap between these two species; the underside of a single rock may have \nCharifson 3 \n \nroughly equal abundances of the two crab species (personal observation). The size of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization. \nBoth species are omnivores that eat algae and small invertebrates, including snails \n(Behrens Yamada and', metadata={}),
 Document(page_content='una vincta, in the Class Gastropoda and Family Littoridae, were collected at False Bay and \nDead Man Cove. Littorina scutulata, in the Class Gastropoda and Family Littoridae, were \ncollected from the rocky intertidal zone of Fourth of July Beach.  \n \nMaterials and Methods: \nMorphometrics \n \nMale and females of H. oregonensis and H. nudus were measured with digital calipers \n(0.1 mm). Each crab was measured for carapace width, propal height and propal width. Carapace \nwidth was taken at the widest part of the carapace. Propal height was measured at the highest \nvertical distance along the propus. Propal width was measured perpendicular to propal height, \nfrom the left to right sides of the propus. All claw measurements were made on the left cheliped. \nCharifson 5 \n \nIf there was a size disparity between the left and right claws due to regeneration of a lost claw, \nthe crab was excluded from the study. Ratios of carapace width:propal height (CW:PH) and \ncarapace width:propal width (CW:PW) were calculated.  \n \nCrab Feeding Preference \n \nThree female (Fe1, Fe2, Fe3) and three male (Ma1, Ma2, Ma3) crabs of H. nudus with \npropal heights between 5-6 mm were placed in small flow-through containers. Five L. scutulata \nand five L. vincta with shell lengths between 4-6 mm were added to each container. The ranges \nof crab propal height and snail shell length were chosen based on prior studies to ensure that the \ncrabs were capable of feeding on the hard-shelled L. scutulata (Behrens Yamada and Boulding \n1998). H. oregonensis was excluded due to the rarity of female crabs of that species within the \nrange of appropriate propal heights. After approximately 15 hours the number of L. scutulata and \nL. vincta consumed was counted. Three trials were conducted for each crab. \nSnail Consumption by Hemigrapsus nudus \n \nThe crabs from the preference experiment were given five of each snail in each trial. \nAfter 1.5 to 3 hours the number of snails consumed was counted and converted to a consumption \nrate (snails consumed/hour). A total of eight feeding trials were conducted.  \n \nStatistical Analysis \n \nFor the morphometric analysis, crabs were divided into four groups based on sex and \nspecies. Standardized major axis regression was used to determine the relationship between crab \nmorphometric parameters. Arcsin transformations were used to correct for non-normality (Sokol \nand Rohlf 2011). Differences in CW:PH and CW:PW were analyzed using a two-way ANOVA \nCharifson 6 \n \nwith factors: Sex and Species. Prey selection by H. nudus was analyzed using G-tests for each \nindividual that consumed snails. An one-way ANOVA was used to determine differences in snail \nconsumption rates by H. nudus.  \n \nResults: \nMorphometrics: \n \nCarapace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>result4 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query4, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>result4[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>'Based on the given context, there is no specific mention of observations made in the field or any other type of data collection methods used in the paper.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>result4[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>[Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}),
 Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}),
 Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>result4[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>[Document(page_content="question: What is this paper about?\nanswer: The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.\nsource_documents: [Document(page_content='Mean Consumption Rate  \\n(Snails Consumed/Hour) \\nIndividual H. nudus', metadata={}), Document(page_content='A multitude of species coexist in the marine intertidal environment. Closely related \\nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \\nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \\nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \\nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \\nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \\nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \\nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \\nconsiderable habitat overlap between these two species; the underside of a single rock may have \\nCharifson 3 \\n \\nroughly equal abundances of the two crab species (personal observation). The size of the chela \\nmay differ, which could allow the crabs to differentiate in food resource utilization.', metadata={}), Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1). In general the ability of carapace width to explain the variance in chela size parameters (i.', metadata={})]", metadata={}),
 Document(page_content="question: Write a one sentence summary of the purpose of the paper\nanswer: The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.\nsource_documents: [Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}), Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \\npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \\nless variation in the relationship between carapace width and propal height than with propal \\nwidth. A significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \\n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \\nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \\nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \\n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \\nrespectively.', metadata={})]", metadata={}),
 Document(page_content="question: Since the crabs were feeding on snails, what were the scientific names of the snails?\nanswer: The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.\nsource_documents: [Document(page_content='Littorina scutulata (Gould 1849) and Littorina sitkana (Philippi 1846)', metadata={}), Document(page_content='Hemigrapsus nudus, Hemigrapsus oregonensis, Littorina scutulata, Lacuna vincta', metadata={}), Document(page_content='Hemigrapsus nudus and Hemigrapsus oregonensis', metadata={})]", metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>result5 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query5, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>result5[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>'The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>result5[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>[Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}),
 Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}),
 Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>result5[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>[Document(page_content="question: Terms that may be used to identify an observation include “in the field”, “this study”, “observed”, “taken”, “collected”, “sampled”, “collection”, “seen”, “harvested”, “found”, etc. Does the paper include one or more observations?\nanswer: Based on the given context, there is no specific mention of observations made in the field or any other type of data collection methods used in the paper.\nsource_documents: [Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}), Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}), Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]", metadata={}),
 Document(page_content="question: What is this paper about?\nanswer: The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.\nsource_documents: [Document(page_content='Mean Consumption Rate  \\n(Snails Consumed/Hour) \\nIndividual H. nudus', metadata={}), Document(page_content='A multitude of species coexist in the marine intertidal environment. Closely related \\nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \\nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \\nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \\nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \\nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \\nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \\nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \\nconsiderable habitat overlap between these two species; the underside of a single rock may have \\nCharifson 3 \\n \\nroughly equal abundances of the two crab species (personal observation). The size of the chela \\nmay differ, which could allow the crabs to differentiate in food resource utilization.', metadata={}), Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1). In general the ability of carapace width to explain the variance in chela size parameters (i.', metadata={})]", metadata={}),
 Document(page_content="question: Write a one sentence summary of the purpose of the paper\nanswer: The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.\nsource_documents: [Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}), Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \\npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \\nless variation in the relationship between carapace width and propal height than with propal \\nwidth. A significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \\n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \\nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \\nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \\n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \\nrespectively.', metadata={})]", metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>result6 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query6, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>result6[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>'The scientific names of the species mentioned in this paper are Hemigrapsus nudus and Hemigrapsus oregonensis.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>result6[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>[Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={}),
 Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={}),
 Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>result6[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>[Document(page_content="question: Since the crabs were feeding on snails, what were the scientific names of the snails?\nanswer: The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.\nsource_documents: [Document(page_content='Littorina scutulata (Gould 1849) and Littorina sitkana (Philippi 1846)', metadata={}), Document(page_content='Hemigrapsus nudus, Hemigrapsus oregonensis, Littorina scutulata, Lacuna vincta', metadata={}), Document(page_content='Hemigrapsus nudus and Hemigrapsus oregonensis', metadata={})]", metadata={}),
 Document(page_content="question: Terms that may be used to identify an observation include “in the field”, “this study”, “observed”, “taken”, “collected”, “sampled”, “collection”, “seen”, “harvested”, “found”, etc. Does the paper include one or more observations?\nanswer: Based on the given context, there is no specific mention of observations made in the field or any other type of data collection methods used in the paper.\nsource_documents: [Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}), Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}), Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]", metadata={}),
 Document(page_content="question: Does this paper contain observational or experimental research conducted in the natural environment or with organisms collected in nature?\nanswer: The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.\nsource_documents: [Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}), Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}), Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={})]", metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>result6a <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query6a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>result6a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'The locations from which the collected species were obtained are not mentioned in the given context.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>result6a[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>[Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={}),
 Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>result7 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query7, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>result7[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'The locations from which the collected species were obtained are not mentioned in the given context.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>result7[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>[Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={}),
 Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>result7[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>[Document(page_content="question: Where were the species collected?\nanswer: The locations from which the collected species were obtained are not mentioned in the given context.\nsource_documents: [Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={}), Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]", metadata={}),
 Document(page_content="question: Terms that may be used to identify an observation include “in the field”, “this study”, “observed”, “taken”, “collected”, “sampled”, “collection”, “seen”, “harvested”, “found”, etc. Does the paper include one or more observations?\nanswer: Based on the given context, there is no specific mention of observations made in the field or any other type of data collection methods used in the paper.\nsource_documents: [Document(page_content='The main objective of this paper is to investigate the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The paper also examines the potential impact of sex and species on this relationship.', metadata={}), Document(page_content='The main topic or subject matter of this paper is the coexistence and competition between two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis, in the marine intertidal environment. The paper also explores the concept of character displacement and the morphological differences between the two species.', metadata={}), Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={})]", metadata={}),
 Document(page_content="question: What are the scientific names of the collected species mentioned in this paper?\nanswer: The scientific names of the species mentioned in this paper are Hemigrapsus nudus and Hemigrapsus oregonensis.\nsource_documents: [Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={}), Document(page_content='The scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={}), Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={})]", metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>result7a <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query7a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>result7a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>'The scientific names of the collected species mentioned in this paper are Hemigrapsus nudus and Hemigrapsus oregonensis. However, the locations from which these species were obtained are not mentioned in the given context.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>result8 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query8, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>result8[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'No, the paper does not mention any specific location where the collected species were obtained.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>result9 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query9, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>result9[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>"I'm sorry, but I don't have any specific coordinate locations in latitude/longitude for the collected species mentioned in the given context."</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>result10 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query10, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>result10[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>'No, the paper does not provide information about the specific habitat where the species were found.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>result10[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>[Document(page_content='No, the paper does not mention any specific location where the collected species were obtained.', metadata={}),
 Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.\nThe scientific names of the snails that the crabs were feeding on are Littorina scutulata and Lacuna vincta.', metadata={}),
 Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>result10a <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query10a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>result10a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>'No, the paper does not mention any formal name or specific geographic location for the habitat where the species were collected.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>result11 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query11, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>result11[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>'No, the paper does not mention any year, date, or time regarding the collection or observation of the species mentioned.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>result11[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>[Document(page_content='No, the paper does not mention any specific location where the collected species were obtained.', metadata={}),
 Document(page_content='No, the paper does not mention any specific location where the collected species were obtained.', metadata={}),
 Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>result11[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>[Document(page_content="question: Does the paper mention where the species were observed or collected, and if so, what locations are given?\nanswer: The locations from which the collected species were obtained are not mentioned in the given context.\nsource_documents: [Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={}), Document(page_content='The research conducted in this paper is primarily focused on investigating the relationship between carapace width and propal height and width in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis.', metadata={})]", metadata={}),
 Document(page_content="question: Can you give a more specific location of the habitat such as formal name of said location?\nanswer: No, the paper does not mention any formal name or specific geographic location for the habitat where the species were collected.\nsource_documents: [Document(page_content='No, the paper does not mention any specific location where the collected species were obtained.', metadata={}), Document(page_content='No, the paper does not mention any specific location where the collected species were obtained.', metadata={}), Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={})]", metadata={}),
 Document(page_content="question: Can you give a more specific location?\nanswer: No, the paper does not mention any specific location where the collected species were obtained.\nsource_documents: [Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={}), Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={}), Document(page_content='The locations from which the collected species were obtained are not mentioned in the given context.', metadata={})]", metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>result12 <span class="op">=</span> qa_chain({<span class="st">"question"</span>: query12, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>result12[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>'No, the paper does not mention any visual representations such as maps, figures, tables, or diagrams.'</code></pre>
</div>
</div>
<section id="conversationalretrievalchain-with-map_reduce" class="level1">
<h1>ConversationalRetrievalChain with map_reduce</h1>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> ChatOpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model_name<span class="op">=</span><span class="st">'gpt-3.5-turbo'</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>compressor <span class="op">=</span> LLMChainExtractor.from_llm(llm)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>compression_retriever2 <span class="op">=</span> ContextualCompressionRetriever(base_compressor <span class="op">=</span> compressor,base_retriever<span class="op">=</span>vector_store)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>memory <span class="op">=</span> VectorStoreRetrieverMemory(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>memory_key<span class="op">=</span><span class="st">"chat_history"</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>return_docs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>retriever<span class="op">=</span>vector_store,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>return_messages<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>qa_chain_reduce <span class="op">=</span> ConversationalRetrievalChain.from_llm(ChatOpenAI(),</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                                                 compression_retriever2,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                                                 memory <span class="op">=</span> memory,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                                                 return_source_documents <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                                                 condense_question_prompt <span class="op">=</span> CUSTOM_QUESTION_PROMPT,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                                                 get_chat_history <span class="op">=</span> get_chat_history,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                                                 chain_type <span class="op">=</span> <span class="st">"map_reduce"</span>)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>                                                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>chat_history <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>result_reduce <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\aclao89\AppData\Local\anaconda3\lib\site-packages\langchain\chains\llm.py:275: UserWarning: The predict_and_parse method is deprecated, instead pass an output parser directly to LLMChain.
  warnings.warn(</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>result_reduce[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>'The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>result_reduce[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>[Document(page_content='The relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.', metadata={}),
 Document(page_content='Mean Consumption Rate  \n(Snails Consumed/Hour)', metadata={}),
 Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1).', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>result_reduce[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>[Document(page_content='8 \n0.9 \n1 \nFe1 \nFe2 \nFe3 \nMa1 \nMa2 \nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus \n', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.  \n \nCrab Feeding Preference:  \n \nExpected values for both the number of L. scutulata and L. vincta consumed for the G-\ntest are 0.5 multiplied by the total number of snails consumed by each individual crab. G-tests \nfor individual H. nudus that eat snails were all significant at p &lt; 0.001 with 1 degree of freedom \n(See Table 2 for statistical summary). The three crabs that did not eat either L. scutulata or L. \nvincta could not be tested for feeding preference.  \nCharifson 7 \n \n \nSnail Consumption by Hemigrapsus nudus \n \nNo significant difference in crab feeding rate (snails consumed/hour) was found (F2, 21 = \n2.52, p = 0.104) among individual H. nudus that fed on snails during the course of the \nconsumption experiment (Figure 5). Fe2  ate snails at a rate of 0.59±0.53 snails/hour (variance is \nstandard deviation), Ma1 feeding rate was 0.24±0.31 snails/hour, and Ma2 had a feeding rate of \n0.80±0.38 snails/hour. Individuals Fe1, Fe3 and Ma3 did not consume any snails during the \ncourse of the experiment.  \n \nDiscussion: \n \nA few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus \nand Hemigrapsus orogenensis. The variance in propal height or propal width explained by \ncarapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for \npropal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela \nsize parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width \nrespectively. The R2 values for propal width regressed against carapace width were consistently \nlower than propal height regressed against carapace width across species and sexes (Table 1). In \ngeneral the ability of carapace width to explain the variance in chela size parameters (i.', metadata={}),
 Document(page_content='Charifson 1 \n \nSnail Predation by Hemigrapsus nudus and Hemigrapsus oregonensis: Sex and Species \nDifferences in Chela Size. \n \nDavid Charifson1,2 \n \nMarine Invertebrate Zoology \nSummer 2014 \n \n \n \n \n1 Friday Harbor Laboratories, University of Washington, Friday Harbor, WA 98250 \n2 Department of Ecology and Evolution, Stony Brook University, Stony Brook, NY 11794-5245 \n \n \n \n \nContact information: \nDavid Charifson \nDepartment of Ecology and Evolution \nStony Brook University \n650 Life Sciences Building \nStony Brook, NY 11794-5245 \nDavid.charifson@stonybrook.edu  \n \n \n \n \nKeywords: Hemigrapsus nudus, Hemigrapsus orogenensis, Littorina scutulata, Lacuna vincta, \npredation, sexual dimorphism, character displacement  \n \n \nCharifson 2 \n \nAbstract: \n \nThe relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.  \n \nIntroduction: \n \nA multitude of species coexist in the marine intertidal environment. Closely related \nspecies may be sympatric and compete for resources, such as food. Two species of shore crab, \nHemigrapsus nudus (Dana 1851) and Hemigrapsus oregonensis (Dana 1851), occur in sympatry \nin the Salish Sea. Both species are sexually dimorphic, with the males having larger chelae. \nSpecies in sympatry may exhibit character displacement, the exaggeration of morphological or \nbehavioral characteristics due to competition for resources (Brown and Wilson 1956). When H. \nnudus and H. oregonensis co-occur, H. oregonensis tends to be found closer to the waterand in \nfiner sediment than the more desiccation-tolerant H. nudus (Sliger 1982). There is still \nconsiderable habitat overlap between these two species; the underside of a single rock may have \nCharifson 3 \n \nroughly equal abundances of the two crab species (personal observation). The size of the chela \nmay differ, which could allow the crabs to differentiate in food resource utilization. \nBoth species are omnivores that eat algae and small invertebrates, including snails \n(Behrens Yamada and', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>result_reduce1a <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query1a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>result_reduce1a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>'The significant findings on the relationship between carapace width and propal height and width in Hemigrapsus crabs are as follows:\n\n- The relationship between carapace width and propal height was analyzed for female H. nudus, male H. nudus, female H. oregonensis, and male H. oregonensis. The line of best fit from SMA regression was provided in Figure 1. The results showed a high variance in propal height explained by carapace width in female H. nudus, with an R2 value of 0.976.\n\n- The relationship between carapace width and propal width was also analyzed for female H. nudus, male H. nudus, female H. oregonensis, and male H. oregonensis. The line of best fit from SMA regression was provided in Figure 2. The results showed a high variance in propal width explained by carapace width in female H. nudus, with an R2 value of 0.927.\n\n- In male H. oregenensis, there was a greater variation in chela size parameters. The R2 values for propal height and propal width regressed against carapace width were 0.693 and 0.534 respectively.\n\n- The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes.\n\nIt is important to note that the text does not mention specific findings for Hemigrapsus crabs, but rather provides information on the significance of carapace width as a predictor of propal height and width in female and male H. oregonensis and H. nudus, with a significant effect for sex and a significant sex*species interaction.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>result_reduce1a[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>[Document(page_content='Figure 1: Relationship of carapace width and propal height in Hemigrapsus. Line of best fit from \nSMA regression. See Table 1A for descriptive statistics. A) Female H. nudus. B) Male H. nudus. \nC) Female H. oregonensis. D) Male H. oregonensis.  \n\nFigure 2: Relationship of carapace width and propal width in Hemigrapsus.  \nLine of best fit from SMA regression. See Table 1B for descriptive statistics. A) Female H. \nnudus. B) Male H. nudus. C)Female H. oregonensis. D) Male H. oregonensis.  \n\nFigure 3: Differences in propal height:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F = 125.6. p &lt; 0.001), while the species factor was \ninsignificant (F &gt; 0.01, p = 0.983). There was a significant interaction (F = 4.39, p = 0.042). \nError bars represent standard error of the mean.  \n\nFigure 4: Differences in propal width:carapace width ratio between sex and species. \nThe sex factor was statistically significant (F1,45 = 103.8. p &lt; 0.001), while the species factor was \ninsignificant (F1,45  = 0.09, p = 0.764). There was a significant interaction (F1,45  = 7.19, p = \n0.01). Error bars represent standard error of the mean.', metadata={}),
 Document(page_content='The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1).', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth. A significant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>result_reduce2 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query2, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>result_reduce2[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>'The concise summary of the paper and the materials and methods used cannot be determined based on the given portion of the document.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>result_reduce2[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>[Document(page_content='The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis. The relationship between propus size and use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal width increases with body size in a predictable manner in male and female crabs of both species. Sexual dimorphism of propal height and width relationships in both shore crabs is apparent, but there was no detectible difference in chela size between H. nudus and H. oregonensis. The lack of difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is no character displacement in this trait. Both species of crabs showed a strong feeding preference for the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely due to the ease of consumption. There were no differences in snail consumption rates between male and female H. nudus of similar propal heights, mostly due to high feeding variation among individual crabs. A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes.', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>result_reduce3 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query3, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>result_reduce3[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>'The purpose of the paper is to investigate the relationship between propus size and the use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>result_reduce3[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>[Document(page_content='The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis. The relationship between propus size and use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal width increases with body size in a predictable manner in male and female crabs of both species. Sexual dimorphism of propal height and width relationships in both shore crabs is apparent, but there was no detectible difference in chela size between H. nudus and H. oregonensis. The lack of difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is no character displacement in this trait. Both species of crabs showed a strong feeding preference for the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely due to the ease of consumption. There were no differences in snail consumption rates between male and female H. nudus of similar propal heights, mostly due to high feeding variation among individual crabs. A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes.', metadata={}),
 Document(page_content='The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis. The relationship between propus size and use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal width increases with body size in a predictable manner in male and female crabs of both species. Sexual dimorphism of propal height and width relationships in both shore crabs is apparent, but there was no detectible difference in chela size between H. nudus and H. oregonensis. The lack of difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is no character displacement in this trait. Both species of crabs showed a strong feeding preference for the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely due to the ease of consumption. There were no differences in snail consumption rates between male and female H. nudus of similar propal heights, mostly due to high feeding variation among individual crabs. A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>result_reduce3[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>[Document(page_content="question: Summarize the paper concisely with reference to materials and methods.\nanswer: The concise summary of the paper and the materials and methods used cannot be determined based on the given portion of the document.\nsource_documents: [Document(page_content='The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis. The relationship between propus size and use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal width increases with body size in a predictable manner in male and female crabs of both species. Sexual dimorphism of propal height and width relationships in both shore crabs is apparent, but there was no detectible difference in chela size between H. nudus and H. oregonensis. The lack of difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is no character displacement in this trait. Both species of crabs showed a strong feeding preference for the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely due to the ease of consumption. There were no differences in snail consumption rates between male and female H. nudus of similar propal heights, mostly due to high feeding variation among individual crabs. A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes.', metadata={}), Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \\npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \\nless variation in the relationship between carapace width and propal height than with propal \\nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \\nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \\n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \\nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \\nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \\n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \\nrespectively.', metadata={})]", metadata={}),
 Document(page_content="question: What is this paper about?\nanswer: The subject matter of this paper appears to be the morphometric analysis of two species of crabs, Hemigrapsus nudus and Hemigrapsus orogenensis.\nsource_documents: [Document(page_content='The relationship between propus size and use of snails as prey in sympatric populations \\nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \\nwidth increases with body size in a predictable manner in male and female crabs of both species. \\nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \\nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \\nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \\nno character displacement in this trait. Both species of crabs showed a strong feeding preference \\nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \\ndue to the ease of consumption. There were no differences in snail consumption rates between \\nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \\nindividual crabs.', metadata={}), Document(page_content='Mean Consumption Rate  \\n(Snails Consumed/Hour)', metadata={}), Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1).', metadata={})]", metadata={}),
 Document(page_content='8 \n0.9 \n1 \nFe1 \nFe2 \nFe3 \nMa1 \nMa2 \nMa3 \nMean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus \n', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>result_reduce4 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query4, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>result_reduce4[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>'Based on the provided portion of the document, it is not possible to determine if the paper includes any observations made in the field, in this study, or through the collection, sampling, or harvesting of specimens. The given text only describes the purpose of the paper, which is to investigate the relationship between propus size and the use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis. Therefore, it is unclear if any direct observations or specimen collection were conducted.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>result_reduce5 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query5, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>result_reduce5[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'No, there is no mention of observational or experimental research conducted in the natural environment or with organisms collected in nature in this portion of the document.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>result_reduce6 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query6, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>result_reduce6[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>'The scientific names of the species collected in this paper are Hemigrapsus nudus and Hemigrapsus orogenensis.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>result_reduce6a <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query6a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>result_reduce6a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>'The document does not provide information about the specific location where the species mentioned in the paper were collected from.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>result_reduce7 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query7, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>result_reduce7[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>"I don't know. The document does not provide information about the specific locations where the species mentioned in the paper were observed or collected."</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>result_reduce7a <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query7a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>result_reduce7a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>'The document does not provide information about the specific locations where the species mentioned in the paper were observed or collected.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>result_reduce8 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query8, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>result_reduce8[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'No, the document does not provide any additional information about the specific locations where the species mentioned in the paper were observed or collected.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>result_reduce9 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query9, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>result_reduce9[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>'No, the document does not provide any latitude/longitude coordinate locations for the species mentioned in the paper.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>result_reduce10 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query10, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>result_reduce10[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>"I'm sorry, but based on the given portion of the document, there is no information available about the habitat in which the species mentioned in the paper were found."</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>result_reduce10a <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query10a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>result_reduce10a[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'No, the document does not provide the formal name of the specific location where the habitat of the species mentioned in the paper was observed or collected.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>result_reduce11 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query11, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>result_reduce11[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>'The document does not provide any information about the year, date, or time that the species were collected or observed.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>result_reduce12 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query12, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>result_reduce12 <span class="op">=</span> qa_chain_reduce({<span class="st">"question"</span>: query12, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>result_reduce12[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>'No, the paper does not contain any maps, figures, tables, or diagrams.'</code></pre>
</div>
</div>
</section>
<section id="conversationalretrievalchain-similarity-search-w-conversationbuffermemory" class="level1">
<h1><strong><em>ConversationalRetrievalChain Similarity Search w/ ConversationBufferMemory </em></strong></h1>
<section id="concept-used-for-streamlit-app" class="level2">
<h2 class="anchored" data-anchor-id="concept-used-for-streamlit-app">Concept used for Streamlit App</h2>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>vector_store2 <span class="op">=</span> FAISS.from_texts(docs, embeddings).as_retriever(search_type <span class="op">=</span> <span class="st">"similarity"</span>, search_kwargs<span class="op">=</span> {<span class="st">"k"</span>: <span class="dv">3</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> ChatOpenAI(temperature<span class="op">=</span><span class="dv">0</span>, model_name<span class="op">=</span><span class="st">'gpt-3.5-turbo'</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>compressor <span class="op">=</span> LLMChainExtractor.from_llm(llm)</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>compression_retriever2 <span class="op">=</span> ContextualCompressionRetriever(base_compressor <span class="op">=</span> compressor,base_retriever<span class="op">=</span>vector_store2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>custom_template <span class="op">=</span> <span class="st">"""Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question. Please use a maximum of 4 sentences. If you do not know the answer reply with 'I am sorry'.</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="st">1. SPECIES NAME: The scientific name (species name) of any plant, animal, fungus, alga or bacterium consists of two Latinized words. The first word is the name of the genus to which the organism belongs. The second word is the specific epithet or specific term of the species. Together, the genus plus the specific epithet make up the species name. The species name and scientific name are synonyms.</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="st">2. HABITAT: A species habitat can be seen as the physical manifestation of its ecological niche.</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="st">3. LOC: Name of any geographic location, like cities, countries, continents, districts etc.</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a><span class="st">1. Sentence: Strongylocentrotus fransiscanus and S. purpuratus were obtained from the subtidal and intertidal regions, respectively, of Monterey Bay.</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a><span class="st">"Output: </span><span class="sc">{{</span><span class="st">'SPECIES NAME': ['Strongylocentrotus fransiscanus', 'S. purpuratus'], 'HABITAT': ['subtidal', 'intertidal'], 'LOC': ['Monterey Bay']</span><span class="sc">}}</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="st">2. Sentence: Cucumaria curata and C. pseudocurata live and feed in the hydrodynamically stressful environment of exposed intertidal areas.</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="st">Output: </span><span class="sc">{{</span><span class="st">'SPECIES NAME': ['Cucumaria curata', 'C. pseudocurata'], 'HABITAT': ['exposed intertidal'], 'LOC': ['None']</span><span class="sc">}}</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="st">Chat History:</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="sc">{chat_history}</span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="st">Follow Up Input: </span><span class="sc">{question}</span></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>CUSTOM_QUESTION_PROMPT <span class="op">=</span> PromptTemplate.from_template(custom_template)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.memory <span class="im">import</span> ConversationBufferMemory</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>memory <span class="op">=</span> ConversationBufferMemory(llm<span class="op">=</span>llm, input_key<span class="op">=</span><span class="st">'question'</span>, output_key<span class="op">=</span><span class="st">'answer'</span>,  return_messages<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Formats the chat history string</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_chat_history(inputs) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> []</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> human, ai <span class="kw">in</span> inputs:</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>        res.append(<span class="ss">f"Human:</span><span class="sc">{</span>human<span class="sc">}</span><span class="ch">\n</span><span class="ss">AI:</span><span class="sc">{</span>ai<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>qa_chain_2 <span class="op">=</span> ConversationalRetrievalChain.from_llm(ChatOpenAI(), </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>                                                 compression_retriever2,</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>                                                 memory <span class="op">=</span> memory,</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>                                                 return_source_documents <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>                                                 condense_question_prompt <span class="op">=</span> CUSTOM_QUESTION_PROMPT,</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>                                                 get_chat_history <span class="op">=</span> get_chat_history)</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>                                                </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"What is this paper about?"</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>query1a <span class="op">=</span> <span class="st">"What were the significant findings on the relationship mentioned?"</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>query2 <span class="op">=</span> <span class="st">"Summarize the paper concisely with reference to materials and methods."</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>query3 <span class="op">=</span> <span class="st">"Write a one sentence summary of the purpose of the paper"</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>query4 <span class="op">=</span> <span class="st">"Terms that may be used to identify an observation include “in the field”, “this study”, “observed”, “taken”, “collected”, “sampled”, “collection”, “seen”, “harvested”, “found”, etc. Does the paper include one or more observations?"</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>query5 <span class="op">=</span> <span class="st">"Does this paper contain observational or experimental research conducted in the natural environment or with organisms collected in nature?"</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>query6 <span class="op">=</span> <span class="st">"What are the scientific names of the collected species mentioned in this paper?"</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>query6a <span class="op">=</span> <span class="st">"Were there other species collected?"</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>query7 <span class="op">=</span> <span class="st">"Does the paper mention where the species were observed or collected, and if so, what locations are given?"</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>query7a <span class="op">=</span> <span class="st">"Please list the species collected based on their scientific names along with location of collection."</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>query8 <span class="op">=</span> <span class="st">"Can you give a more specific location?"</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>query9 <span class="op">=</span> <span class="st">"Are any coordinate locations given in latitude / longitude, and if so, what are they?"</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>query10 <span class="op">=</span> <span class="st">"In what habitat were the species found?"</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>query10a <span class="op">=</span> <span class="st">"Can you give a more specific location of the habitat such as formal name of said location?"</span></span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>query11 <span class="op">=</span> <span class="st">"Does the paper mention a year, date and/or time that species were collected or observed, and if so, what was mentioned?"</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>query12 <span class="op">=</span> <span class="st">"Are there any maps, figures, tables or diagrams in the paper?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>chat_history <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>result1b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>result1b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>'This paper is about the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis, specifically focusing on the relationship between propus size and the use of snails as prey in sympatric populations. The paper explores the patterns and variations in propal height and width in male and female crabs of both species and examines the feeding preferences of the crabs for different types of snails. It also discusses the lack of difference in chela size between the two species and suggests that there is no character displacement in this trait.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>result1b[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>[Document(page_content='Mean Consumption Rate  \n(Snails Consumed/Hour) \nIndividual H. nudus', metadata={}),
 Document(page_content='A few interesting patterns emerged in the morphometric analysis of Hemigrapsus nudus and Hemigrapsus orogenensis. The variance in propal height or propal width explained by carapace width was surprisingly high in female H. nudus with R2 values of 0.976 found for propal height and 0.927 for propal width. Male H. oregenensis had the greatest variation in chela size parameters, demonstrated by R2 of 0.693 and 0.534 for propal height and propal width respectively. The R2 values for propal width regressed against carapace width were consistently lower than propal height regressed against carapace width across species and sexes (Table 1). In general the ability of carapace width to explain the variance in chela size parameters (i.', metadata={}),
 Document(page_content='The relationship between propus size and use of snails as prey in sympatric populations \nof Hemigrapsus nudus and Hemigrapsus oregonensis was investigated. Propal height and propal \nwidth increases with body size in a predictable manner in male and female crabs of both species. \nSexual dimorphism of propal height and width relationships in both shore crabs is apparent, but \nthere was no detectible difference in chela size between H. nudus and H. oregonensis. The lack \nof difference in chela size between sympatric H. nudus and H. oregonensis suggests that there is \nno character displacement in this trait. Both species of crabs showed a strong feeding preference \nfor the thin-shelled gastropod Lacuna vincta over the thicker shelled Littorina scutulata, likely \ndue to the ease of consumption. There were no differences in snail consumption rates between \nmale and female H. nudus of similar propal heights, mostly due to high feeding variation among \nindividual crabs.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>result1b[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>[]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>result2b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query2, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>result2b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>'The paper examined the relationship between carapace width and chela size in two species of shore crabs, Hemigrapsus nudus and Hemigrapsus oregonensis. The study focused on both females and males of the two species. The authors used a two-way ANOVA with factors sex and species to analyze the data. They also performed an arcsin transformation due to non-normality of certain variables. The results showed that carapace width was a good predictor of propal height and propal width in both female and male crabs. There was no significant difference in chela size between the two species. However, a significant sex*species interaction was found. The study suggests that trade-offs between claw size and factors like feeding efficiency or resource allocation may explain the variation in chela size.'</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="102">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>result2b[<span class="st">"source_documents"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>[Document(page_content='apace width were consistently \nlower than propal height regressed against carapace width across species and sexes (Table 1). In \ngeneral the ability of carapace width to explain the variance in chela size parameters (i.e.: R2 \nvalues) was greater in females of both crab species (Table 1, Figures 1 and 2). Males may have \nmore variation in claw size due to trade-offs between claw size and factors like feeding \nefficiency or resource allocation. Trade-offs relating to chela size are found in fiddler crabs, \nwhich exhibit extreme sexual dimorphism. Fiddler crabs have a trade-off between the intrasexual \ncompetition and intersexual signaling functions of the dimorphic claw (Swanson et al. 2013). \nCharifson 8 \n \nThis is not to say that the particular trade-offs in fiddler crabs case are analogous to that of \nHemigrapsus, since both claws in the two shore crabs in this study are used in feeding.  \nSexual dimorphism in chela size, which is readily apparent to the eye in both \nHemigrapsus nudus and Hemigrapsus oregonensis, was detected statistically (Figures 3 and 4). \nThe two-way ANOVA with factors sex and species did not show a significant species effect, \nsuggesting that the claws of both shore crabs produce roughly the same force and are \nfunctionally equivalent (Behrens Yamada and Boulding 1998). The lack of morphological \ndifference in the size of the chelae between the crab species removes the possibility of character \ndisplacement in the trait. It should be noted that this study was not designed to test for character \ndisplacement, but to determine if this would be an interesting question for future investigations. \nTo make a compelling case for character displacement it is necessary to compare multiple \nsympatric and allopatric populations with similar abiotic and biotic conditions (Stuart and Losos \n2013). Also it must be demonstrated that the trait differs due to genetic differences between \nsympatric and allopatric populations, that the differences between the populations are not due to \nspecies sorting, that the morphological trait is correlated to differences in resource use between \nthe two sympatric species, and that the similar phenotype in allopatric populations compete for \nthe same resources (Stuart and Losos 2013). The tendency of H. nudus to occupy the upper \nintertidal zone (Sliger 1987), despite considerable overlap with H. oregonensis, may provide \nenough differential resource use to prevent exclusion in sympatry. Desiccation tolerance may be \na better trait to test for character displacement in these shore crabs.', metadata={}),
 Document(page_content='ace width was a good predictor of both propal height (Figure 1, Table 1A) and \npropal width (Figure 2, Table 1B) in female and male H. oregonensis and H. nudus. There was \nless variation in the relationship between carapace width and propal height than with propal \nwidth.  Due to non-normality of CW:PH and CW:PW an arcsin transformation was used. A \nsignificant effect for sex was found for both CW:PH (F1, 45 = 125.6, p &lt; 0.001) and CW:PW  (F1, \n45 = 103.81, p &lt; 0.001). There was no significant difference between Hemigrapsus species for \nCW:PH (F1, 45 &lt; 0.01, p = 0.983) and CW:PW (F1, 45 = 0.09, p = 0.764). A significant \nsex*species interaction was detected for both CW:PH (F1, 45 4.39, p = 0.042) and CW:PW (F1, 45 \n= 7.19, p = 0.010). Figure 3 and 4 show the means of CW:PH and CW:PW in by sex and species \nrespectively.', metadata={})]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>result2b[<span class="st">"chat_history"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>[]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>result3b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query3, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>result3b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>'The purpose of the paper was to investigate the relationship between propus size and the use of snails as prey in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis, and to determine if there was any character displacement in chela size between the two species.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>result4b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query4, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>result4b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>'Yes, the paper includes several observations. It mentions the collection of una vincta and Littorina scutulata from different locations, the absence of detectable differences in chela size between H. nudus and H. oregonensis, and the feeding preference of both crab species for Lacuna vincta over Littorina scutulata. It also states that there were no differences in snail consumption rates between male and female H. nudus of similar propal heights.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>result5b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query5, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>result5b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>"Based on the given context, it appears that the research described in the paper is observational in nature. The crabs' feeding preferences and snail consumption rates were observed in sympatric populations of Hemigrapsus nudus and Hemigrapsus oregonensis. Snails were collected from different locations in the natural environment, suggesting that the research involved organisms collected in nature."</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>result6b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query6, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>result6b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>'The scientific names of the collected species mentioned in this paper are:\n\n- Lacuna vincta\n- Littorina scutulata\n- Hemigrapsus nudus\n- Hemigrapsus oregonensis'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>result7b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query7, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>result7b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>'Yes, the paper mentions the locations where the species were collected. Lacuna vincta was collected at False Bay and Dead Man Cove, while Littorina scutulata was collected from the rocky intertidal zone of Fourth of July Beach.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>result7c <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query7a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="106">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>result7c[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>'Based on the given information, the species collected and their respective locations are:\n\n1. Lacuna vincta - Collected at False Bay and Dead Man Cove.\n2. Littorina scutulata - Collected from the rocky intertidal zone of Fourth of July Beach.\n3. Hemigrapsus nudus - No information provided about the location of collection.\n4. Hemigrapsus oregonensis - No information provided about the location of collection.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>result8b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query8, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>result8b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>'Yes, the specific locations mentioned in the context are False Bay, Dead Man Cove, and Fourth of July Beach.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>result9b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query9, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>result9b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>"I'm sorry, but I don't have access to any specific coordinate locations in latitude/longitude at the moment."</code></pre>
</div>
</div>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>result10b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query10, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>result10b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>'The species una vincta and Littorina scutulata were found in the rocky intertidal zone at False Bay, Dead Man Cove, and Fourth of July Beach on San Juan Island, Washington. The shore crabs Hemigrapsus oregonensis and Hemigrapsus nudus were collected in the intertidal zone adjacent to the Friday Harbor Laboratories dock.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>result10c <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query10a, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>result10c[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>'The specific location mentioned in the context is San Juan Island, Washington. However, the context does not provide any formal names of the habitats or locations where the specimens were collected.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>result11b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query11, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>result11b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>'Yes, the paper mentions the year as "Summer 2014". However, it does not mention a specific date or time when the species were collected or observed.'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>result12b <span class="op">=</span> qa_chain_2({<span class="st">"question"</span>: query12, <span class="st">"chat_history"</span>: chat_history})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>result12b[<span class="st">"answer"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>'Yes, there are figures and tables in the paper. Specifically, there are Figure 1, Table 1A, Figure 2, Table 1B, Figure 3, and Figure 4.'</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© CC-1.0</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>